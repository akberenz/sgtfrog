/*!
// ==UserScript==
// @name         SteamGifts Tinkerer, Featuring Refined Ostensible Gain
// @namespace    https://github.com/bberenz/sgtfrog
// @description  SteamGifts.com user controlled enchancements
// @icon         https://raw.githubusercontent.com/bberenz/sgtfrog/master/keroro.gif
// @include      *://*.steamgifts.com/*
// @version      0.3.5
// @downloadURL  https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.user.js
// @updateURL    https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.meta.js
// @require      https://code.jquery.com/jquery-1.12.3.min.js
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// ==/UserScript==
*/
(function(){var e=$(document);if($(".nav__sits").length){console.warn("[RIBBIT] User is not logged in, cannot run script.");throw new Error("No lilypad.")}(function(){if(GM_getValue("stickHead")===undefined){return}console.log("ONE-TIME - converting old settings values");var f=GM_getValue("stickHead",1)*4|GM_getValue("stickSide",1)*2|GM_getValue("stickFoot",0)*1;GM_setValue("fixedElms",f);GM_deleteValue("stickHead");GM_deleteValue("stickSide");GM_deleteValue("stickFoot");var h=GM_getValue("loadGA",1)*8|GM_getValue("loadThread",0)*4|GM_getValue("loadTrade",0)*2|GM_getValue("loadComment",0)*1;GM_setValue("loadLists",h);GM_deleteValue("loadGA");GM_deleteValue("loadThread");GM_deleteValue("loadTrade");GM_deleteValue("loadComment");var i=GM_getValue("collapseThread",1)*2|GM_getValue("collapseTrade",1)*1;GM_setValue("collapsed",i);GM_deleteValue("collapseThread");GM_deleteValue("collapseTrade");var g=GM_getValue("points",0);if(g){GM_setValue("pointInvl",(30/(c.points.value)))}GM_deleteValue("points");GM_setValue("colorBadge",GM_getValue("colorBadges",1));GM_deleteValue("colorBadges");GM_setValue("userDetail",GM_getValue("userDetails",1));GM_deleteValue("userDetails");GM_setValue("activeTalk",GM_getValue("activeThread",2));GM_deleteValue("activeThread")})();var c={fixedElms:{value:GM_getValue("fixedElms",6),set:{type:"square",opt:["Header","Sidebar","Footer"]},query:"Set fixed elements:"},loadLists:{value:GM_getValue("loadLists",15),set:{type:"square",opt:["Giveaways","Discussions","Trades","Comments"]},query:"Continuously load:"},gridView:{value:GM_getValue("gridView",0),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaways in a grid view?"},featuredGA:{value:GM_getValue("featuredGA",2),set:{type:"circle",opt:["Yes","Expanded","No"]},query:"Show featured giveaways section?"},hideEntry:{value:GM_getValue("hideEntry",1),set:{type:"circle",opt:["Yes","No"]},query:"Hide entered giveaways?"},oneHide:{value:GM_getValue("oneHide",0),set:{type:"circle",opt:["Yes","No"]},query:"Skip confirmation when hiding games?"},winPercent:{value:GM_getValue("winPercent",1),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaway win percentage?"},searchSame:{value:GM_getValue("searchSame",1),set:{type:"circle",opt:["Yes","No"]},query:"Show buttons to quickly search for similar giveaways?"},newBadges:{value:GM_getValue("newBadges",1),set:{type:"circle",opt:["Yes","No"]},query:"Show additional giveaway badges?"},colorBadge:{value:GM_getValue("colorBadge",1),set:{type:"circle",opt:["Yes","No"]},query:"Recolor standard giveaway badges?"},searchNav:{value:GM_getValue("searchNav",0),set:{type:"circle",opt:["Yes","No"]},query:"Show the giveaway search bar in the top navigation?"},pointInvl:{value:GM_getValue("pointInvl",0),set:{type:"number",opt:["Seconds"],about:"Value in seconds, enter 0 to disable."},query:"Regularly update points value?"},sideMine:{value:GM_getValue("sideMine",0),set:{type:"circle",opt:["Yes","No"]},query:"Hide 'My Giveaways' in the sidebar? (Still available under nav dropdown)"},activeTalk:{value:GM_getValue("activeTalk",2),set:{type:"circle",opt:["Yes","Sidebar","No"]},query:"Show the 'Active Discussions' section?"},collapsed:{value:GM_getValue("collapsed",3),set:{type:"square",opt:["Discussions","Trades"]},query:"After first page, collapse original post:"},userTools:{value:GM_getValue("userTools",1),set:{type:"circle",opt:["Yes","No"]},query:"Show SGTools links on user pages?"},userDetail:{value:GM_getValue("userDetail",1),set:{type:"circle",opt:["Yes","No"]},query:"Show user details on avatar hover?"},userLists:{value:GM_getValue("userLists",1),set:{type:"circle",opt:["Yes","No"]},query:"Label black-/white- listed users?",sub:{name:"Configure",settings:{userWhite:{value:JSON.parse(GM_getValue("userWhite",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Whitelisted label colors:"},userBlack:{value:JSON.parse(GM_getValue("userBlack",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Blacklisted label colors:"}}}}};
var d={debug:0,logging:{debug:function(f){if(d.debug<-1){console.debug("[SGT DEBUG] ",f)}},info:function(f){if(d.debug<0){console.log("[SGT INFO] ",f)}},warn:function(f){if(d.debug<0){console.warn("[SGT WARN] ",f)}},alert:function(f){console.log("[SGT ALERT] ",f)}},helpers:{fromQuery:function(h){var g,f={},j=/([^&=]+)=?([^&]*)/g,i=function(k){return decodeURIComponent(k.replace(/\+/g," "))};while(g=j.exec(location.search.substring(1))){f[i(g[1])]=i(g[2])}return f[h]},isGAlist:function(){return !(~location.href.indexOf("/trade")||~location.href.indexOf("/discussion")||~location.href.indexOf("/giveaway/")||~location.href.indexOf("/account/")||~location.href.indexOf("/archive")||~location.href.indexOf("/settings"))},listingPit:{cache:{wishes:{name:"cache-wish",page:"/account/steam/wishlist/search?page=",touches:".table__column__secondary-link",list:null},white:{name:"cache-white",page:"/account/manage/whitelist/search?page=",touches:".table__column__heading",list:null},black:{name:"cache-black",page:"/account/manage/blacklist/search?page=",touches:".table__column__heading",list:null}},getList:function(g,i){d.logging.debug("Pulling list for "+g);var f=d.helpers.listingPit.cache[g];if(!f.list){var h=JSON.parse(GM_getValue(f.name,null));if(h==null){d.logging.debug("Entering hell..");d.helpers.listingPit.callbackHell(f.page,1,f.touches,function(j){GM_setValue(f.name,JSON.stringify(j));GM_setValue(f.name+"-time",Date.now());f.list=j;i(j)})}else{d.logging.debug("Had it saved..");f.list=h;i(h)}}else{d.logging.debug("Already loaded..");i(f.list)}},invalidateList:function(f){d.logging.debug("Invalidating "+f);GM_setValue(d.helpers.listingPit.cache[f].name,null)},callbackHell:function(g,i,h,f){$.ajax({method:"GET",url:g+i}).done(function(m){var k=$(m),l=k.find(".pagination__navigation").children().last().attr("data-page-number");var j=[];$.each(k.find(h),function(n,o){j.push($(o).attr("href"))});if(i<l){d.logging.debug("Going deeper..");d.helpers.listingPit.callbackHell(g,++i,h,function(n){f($.merge(j,n))})}else{f(j)}})}},makeSideLink:function(g,f,i,h){var l=$("<li/>").addClass("sidebar__navigation__item");var j=$("<a/>").addClass("sidebar__navigation__item__link").attr("href",g).appendTo(l);var k=$("<div/>").addClass("sidebar__navigation__item__name").html(f).appendTo(j);if(h!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(h).appendTo(k)}$("<div/>").addClass("sidebar__navigation__item__underline").appendTo(j);if(i!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(i).appendTo(j)}return l},makeTopLink:function(i,h,l,j,g){var k=$("<a/>").addClass("nav__row").attr("href",i);$("<i/>").addClass("icon-"+g).addClass("fa fa-fw fa-"+j).appendTo(k);var f=$("<div/>").addClass("nav__row__summary").appendTo(k);$("<p/>").addClass("nav__row__summary__name").html(h).appendTo(f);$("<p/>").addClass("nav__row__summary__description").html(l).appendTo(f);return k},settings:{makeRow:function(q,h,p,f){var m;switch(f.set.type){case"circle":m=d.helpers.settings.makeRadio(h,p,f);
break;case"square":m=d.helpers.settings.makeCheck(h,p,f);break;case"number":case"text":m=d.helpers.settings.makeText(h,p,f);break;default:d.logging.warn("Cannot determine options type: "+f.set.type);return}q.append(m);if(f.sub){m.find(".form__checkbox").last().after($("<div/>").addClass("form__checkbox is-selected").append($("<a/>").html(f.sub.name)).on("click",function(i){$("#sub_"+p).toggle();i.stopImmediatePropagation()}));var n="abcde";var l=$("<div/>").attr("id","sub_"+p).css("display","none").appendTo(q);var o=Object.keys(f.sub.settings);for(var j=0;j<o.length;j++){var g=o[j];if(f.sub.settings.hasOwnProperty(g)){d.helpers.settings.makeRow(l,h+n.substring(j,j+1),g,f.sub.settings[g])}}}},makeHeading:function(h,g){var f=$("<div/>").addClass("form__row");$("<div/>").addClass("form__heading").append($("<div/>").addClass("form__heading__number").html(h+".")).append($("<div/>").addClass("form__heading__text").html(g)).appendTo(f);return f},makeRadio:function(k,j,h){var m=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",j).val(h.value));for(var g=0;g<h.set.opt.length;g++){var l=h.set.opt.length-1-g;var f=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",l).append("<i class='form__checkbox__default fa fa-circle-o'></i>").append("<i class='form__checkbox__hover fa fa-circle'></i>").append("<i class='form__checkbox__selected fa fa-check-circle'></i>").append(h.set.opt[g]);if(h.value==l){f.addClass("is-selected")}else{f.addClass("is-disabled")}m.append(f)}return d.helpers.settings.makeHeading(k,h.query).append($("<div/>").addClass("form__row__indent").append(m))},makeCheck:function(j,h,g){var m=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",h).val(g.value));for(var f=0;f<g.set.opt.length;f++){var l=Math.pow(2,g.set.opt.length-1-f);var k=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",l).append("<i class='form__checkbox__default fa fa-square-o'></i>").append("<i class='form__checkbox__hover fa fa-square'></i>").append("<i class='form__checkbox__selected fa fa-check-square'></i>").append(g.set.opt[f]).on("click",function(i){var n=$(this),o=n.siblings("input");o.val(o.val()^n.attr("data-checkbox-value"));if(o.val()&n.attr("data-checkbox-value")){n.removeClass("is-disabled").addClass("is-selected")}else{n.addClass("is-disabled").removeClass("is-selected")}i.stopImmediatePropagation()});if(g.value&l){k.addClass("is-selected")}else{k.addClass("is-disabled")}m.append(k)}return d.helpers.settings.makeHeading(j,g.query).append($("<div/>").addClass("form__row__indent").append(m))},makeText:function(j,i,g){var f=$("<div/>").addClass("form__row__indent");$.each(g.set.opt,function(l,k){var n=g.value,m="";if(g.set.opt.length>1){n=g.value[k];m="_"+l}f.append($("<input/>").attr("type",g.set.type).attr("name",i+m).attr("placeholder",k).addClass("form__input-small").val(n))});var h=$("<div/>").addClass("form__input-description").html(g.set.about);return d.helpers.settings.makeHeading(j,g.query).append(f.append(h))
}},applyGradients:function(g,f){g.css("background-image","linear-gradient("+f+")").css("background-image","-moz-linear-gradient("+f+")").css("background-image","-webkit-linear-gradient("+f+")")}},settings:{invalidateOnSync:function(){if(!c.newBadges.value||!~location.href.indexOf("/profile/sync")){return}$(".form__sync-default").on("click",function(){d.helpers.listingPit.invalidateList("wishes")})},injectMenu:function(h){d.logging.debug("Adding custom navigation");var g=$("<div/>").addClass("nav__button-container");$("<a/>").addClass("nav__button nav__buton--is-dropdown").attr("href","/ąccount/settings/ribbit").html("SGT frog").appendTo(g);$("<div/>").addClass("nav__button nav__button--is-dropdown-arrow").html("<i class='fa fa-angle-down'></i>").appendTo(g).on("click",function(k){var j=$(this).hasClass("is-selected");$("nav .nav__button").removeClass("is-selected"),$("nav .nav__relative-dropdown").addClass("is-hidden"),j||$(this).addClass("is-selected").siblings(".nav__relative-dropdown").removeClass("is-hidden"),k.stopImmediatePropagation()});var i=$("<div/>").addClass("nav__relative-dropdown is-hidden").appendTo(g);$("<div/>").addClass("nav__absolute-dropdown").append(d.helpers.makeTopLink("/ąccount/settings/ribbit","Settings","Adjust tool functionality.","gears","grey")).append(d.helpers.makeTopLink("https://github.com/bberenz/sgtfrog/issues","Feedback","Report an issue or request a feature.","github","green")).append(d.helpers.makeTopLink("https://www.steamgifts.com/discussion/4C3Cl/userscript-steamgifts-tinkerer-featuring-refined-ostensible-gain","Discussion","View the SteamGifts discussion thread.","square-o","blue")).appendTo(i);$(".nav__right-container").find(".nav__button-container:not(.nav__button-container--notification)").last().before(g);var f=d.helpers.makeSideLink("/ąccount/settings/ribbit","SGT frog");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().after(f);if(h){f.addClass("is-selected");f.find(".sidebar__navigation__item__name").before("<i class='fa fa-caret-right'></i>")}},injectPage:function(){if(location.pathname==="/%C4%85ccount/settings/ribbit"){d.logging.info("Creating custom settings page");GM_addStyle("body{ background-image: none; background-color: #95A4C0; }");var f=$("style").detach();$("html").empty();$.ajax({method:"GET",url:"/account/settings/sales"}).done(function(n){var l=n.substring(n.indexOf("<head>")+6,n.indexOf("</head>")).replace(/<script [\s\S]+?<\/script>/g,"");$("<head/>").appendTo("html").append(l).append("<script src='https://cdn.steamgifts.com/js/minified.js'><\/script>");$("<body/>").appendTo("html").append(n.substring(n.indexOf("<body>")+6,n.indexOf("</body>")));f.appendTo("html");$(".page__heading__breadcrumbs").children("a").last().html("Sgt Frog").attr("href","/ąccount/settings/ribbit");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().removeClass("is-selected").find("i").remove();$("title").html("Account - Settings - Ribbit");var h=$(".form__rows");
h.empty();var m=Object.keys(c);for(var j=0;j<m.length;j++){var g=m[j];if(c.hasOwnProperty(g)){d.helpers.settings.makeRow(h,j+1,g,c[g])}}$("<div/>").addClass("form__submit-button").html("<i class='fa fa-arrow-circle-right'></i> Save Changes").on("click",function(){d.settings.save(c)}).appendTo(h);d.logging.debug("Creation complete");window.setTimeout(function(){d.settings.injectMenu(true);d.giveaways.injectNavSearch();d.fixedElements.header();d.fixedElements.sidebar();d.fixedElements.footer();e.scroll()},500)})}},save:function(o){var m=function(i,j){d.logging.debug("Setting "+i+" to "+j);GM_setValue(i,j)};var q=Object.keys(o);for(var l=0;l<q.length;l++){var g=q[l];if(o.hasOwnProperty(g)){if(o[g].set.type=="text"&&o[g].set.opt.length>1){var p={};for(var h=0;h<o[g].set.opt.length;h++){var f=$("input[name='"+g+"_"+h+"']");p[o[g].set.opt[h]]=f.val()}m(g,JSON.stringify(p))}else{var n=$("input[name='"+g+"']");m(g,+n.val())}if(o[g].sub){d.settings.save(o[g].sub.settings)}}}d.logging.info("Saved new settings");window.scrollTo(0,0);location.reload()}},fixedElements:{header:function(){if(!(c.fixedElms.value&4)){return}GM_addStyle("header.fixed{ position: fixed; top: 0; width: 100%; z-index: 100; } .left-above{ margin-top: 39px !important; }");$("header").addClass("fixed");var f=$(".featured__container");if(f.length>0){f.addClass("left-above")}else{$(".page__outer-wrap").addClass("left-above")}},sidebar:function(){if(!(c.fixedElms.value&2)){return}var i=c.fixedElms.value&4?64:25;GM_addStyle(".sidebar .fixed{ position: fixed; top: "+i+"px; }");var g=$(".sidebar"),f=$("<div/>").addClass("sidebar__outer-wrap"),h=$(".sidebar__mpu");g.children().detach().appendTo(f);f.appendTo(g);e.on("scroll",function(){var j=$(".featured__container").height()+64;if(e.scrollTop()>(j-i)){g.children().addClass("fixed");h.hide()}else{g.children().removeClass("fixed");h.show()}});f.css("width",g.css("min-width")).css("min-width",g.css("min-width")).css("max-width",g.css("max-width"))},footer:function(){if(!(c.fixedElms.value&1)){return}GM_addStyle(".footer__outer-wrap.fixed{ position: fixed; bottom: 0; width: 100%;   background-color: #95a4c0; z-index: 100; } .left-below{ margin-bottom: 45px; }");$(".footer__outer-wrap").addClass("fixed");$(".page__outer-wrap").addClass("left-below")}},sidebar:{removeMyGA:function(){if(!c.sideMine.value){return}var g=$(".sidebar");var f=g.find(".sidebar__heading").last();if(f.html()==="My Giveaways"){f.remove();g.find(".sidebar__navigation").last().remove()}},injectSGTools:function(){if(!c.userTools.value||!~location.href.indexOf("/user/")){return}var g=location.href.split("/")[4];d.logging.debug("Found user: "+g);var f=$(".sidebar__navigation").last(),h=$("<ul/>").append(d.helpers.makeSideLink("http://www.sgtools.info/sent/"+g,"Real Value Sent").find("a").attr("target","_check"),d.helpers.makeSideLink("http://www.sgtools.info/won/"+g,"Real Value Won").find("a").attr("target","_check"),d.helpers.makeSideLink("http://www.sgtools.info/nonactivated/"+g,"Non-Activated").find("a").attr("target","_check"),d.helpers.makeSideLink("http://www.sgtools.info/multiple/"+g,"Multi Wins").find("a").attr("target","_check"));
$("<h3/>").html("SG Tools").addClass("sidebar__heading").insertAfter(f).after(h.addClass("sidebar__navigation"))}},giveaways:{injectFlags:{all:function(f){if(c.newBadges.value){d.giveaways.injectFlags.wishlist(f);d.giveaways.injectFlags.recent(f)}if(c.colorBadge.value){d.giveaways.injectFlags.invite();d.giveaways.injectFlags.region();d.giveaways.injectFlags.whitelist();d.giveaways.injectFlags.group()}},wishlist:function(i,g){var f=$(".giveaway__row-outer-wrap");if(f.length>0){if(!g){GM_addStyle(".giveaway__column--wish{ background-image: linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -moz-linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -webkit-linear-gradient(#FFFACF 0%, #FFF176 100%);   border-color: #EDCCBE #F0C2AF #DEAB95 #F2C4B1 !important; color: #F57F17;   box-shadow: none !important; }")}var h=$("<div/>").addClass("giveaway__column--wish").attr("title","Wishlist");$("<i/>").addClass("fa fa-fw fa-star").appendTo(h);if(Date.now()-GM_getValue("cache-wish-time",0)>(24*60*60*1000)){d.helpers.listingPit.invalidateList("wishes")}d.helpers.listingPit.getList("wishes",function(j){d.logging.info("Applying badges for "+j.length+" wishes");$.each(j,function(l,n){var k=i.find("a[href='"+n+"']").parent().parent();var m=k.find(".giveaway__columns--badges");if(m.length){m.prepend(h.clone())}else{k.find(".giveaway__column--width-fill").after(h.clone())}})})}},recent:function(h,f){if(!f){GM_addStyle(".giveaway__column--new{   background-image: linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -moz-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -webkit-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   border-color: #FFCCBC #FFAB91 #FF8A65 #FFAB91 !important; color: #BF360C;   box-shadow: none !important; }")}var g=$("<div/>").addClass("giveaway__column--new").attr("title","New");$("<i/>").addClass("fa fa-fw fa-fire").appendTo(g);$.each(h.find(".giveaway__column--width-fill").find("span"),function(j,m){var l=$(m);var k=l.html();if(~k.indexOf("second")||~k.indexOf("minute")){l.parent().parent().find(".giveaway__column--width-fill").after(g.clone())}})},invite:function(){GM_addStyle(".giveaway__column--invite-only{ background-image: linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -moz-linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -webkit-linear-gradient(#FFCDD2 0%, #F49B95 100%);   border-color: #ef9a9a #e57373 #ef5350 #e57373 !important; color: #950000; }")},region:function(){GM_addStyle(".giveaway__column--region-restricted{ background-image: linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -moz-linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -webkit-linear-gradient(#D7CCC8 0%, #A18F89 100%);   border-color: #BDBDBD #9E9E9E #757575 #9E9E9E !important; color: #5D4037; }")},whitelist:function(){GM_addStyle(".giveaway__column--whitelist{ background-image: linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -moz-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -webkit-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   color: #D81B60 !important; }")
},group:function(){GM_addStyle(".giveaway__column--group{ background-image: linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -moz-linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -webkit-linear-gradient(#DCEDC8 0%, #AED581 100%); ")}},injectChance:function(g){if(!c.winPercent.value){return}var f=function(h,i){return"<i class='fa fa-bar-chart'></i> <span>"+Math.min(100,(1/h)*i*100).toFixed(3)+"% chance</span>"};$.each(g.find(".giveaway__row-outer-wrap"),function(j,o){var m=$(o);var h=m.find(".fa-tag").next().html().split(/\s/)[0].replace(/,/g,"");var l=m.find(".giveaway__columns").children().first().find("span").html().substr(0,5);if(l!=="Ended"&&!m.find(".giveaway__row-inner-wrap").hasClass("is-faded")){h++}var n=1;var p=m.find(".giveaway__heading__thin").first().html();if(p&&~p.indexOf("Copies")){n=+(p.replace(/([\(\),\s]|Copies)/g,""))}var k=$("<div/>").html(f(h,n));m.find(".giveaway__columns").children().first().after(k)});$.each(g.find(".featured__columns"),function(l,n){var k=g.find(".live__entry-count");if(!k||k.length===0){return}var h=k.html().replace(/,/g,"");var j=g.find(".sidebar__entry-insert");if(j&&j.length>0&&!j.hasClass("is-hidden")){h++}var o=1;var p=g.find(".featured__heading__small").first().html();if(~p.indexOf("Copies")){o=+(p.replace(/([\(\),\s]|Copies)/g,""))}var m=$("<div/>").addClass("featured__column").html(f(h,o));$(n).children().first().after(m)})},injectSearch:function(i,g){if(!c.searchSame.value){return}$.each(i.find(".giveaway__heading"),function(j,l){var k=$(l);$("<a/>").addClass("giveaway__icon").html("<i class='fa fa-search-plus'></i>").attr("title","Find similar giveaways").attr("href","/giveaways/search?q="+k.find(".giveaway__heading__name").html()).appendTo(k)});if(~location.href.indexOf("/giveaway/")){if(!g){GM_addStyle(".sidebar__shortcut-inner-wrap div{ padding: 0; } .sidebar__shortcut-inner-wrap .sidebar__error{ border-color: #f0d1dc #e5bccc #d9a7ba #ebbecf; }")}var f=$(".sidebar__navigation").parent();var h=f.children().first().not(".sidebar__mpu").detach();if(!h.hasClass("sidebar__error")){h.css("background-image","none").css("border","none")}else{d.helpers.applyGradients(h,"#f7edf1 0%, #e6d9de 100%")}$("<div/>").addClass("sidebar__shortcut-inner-wrap").append($("<a/>").addClass("sidebar__entry-loading").css("max-width",(h.length>0?"33%":"100%")).html("<i class='fa fa-search'></i> Find Similar").attr("href","/giveaways/search?q="+$(".featured__heading__medium").html())).append(h).appendTo($("<div/>").addClass("sidebar__shortcut-outer-wrap").prependTo(f))}},injectNavSearch:function(){if(!c.searchNav.value){return}var f=$("<div/>").addClass("sidebar__search-container").css("margin","0 5px 0 0").css("height","inherit").append($("<input class='sidebar__search-input' placeholder='Search Giveaways...' value='' type='text' />").on("keypress",function(g){if(g.which===13){location.href="/giveaways/search?q="+$(this).val();g.stopImmediatePropagation()}})).append("<i class='fa fa-search'></i>");
$(".nav__left-container").prepend(f)},hideEntered:function(f){if(!c.hideEntry.value||~location.href.indexOf("/giveaways/won")){return}f.find(".is-faded").parent(".giveaway__row-outer-wrap").remove()},easyHide:function(f){if(!c.oneHide.value){return}f.find("[data-popup='popup--hide-games']").on("click",function(g){window.setTimeout(function(){$(".js__submit-hide-games").click()},100)})},gridForm:function(g,f){if(!c.gridView.value||!d.helpers.isGAlist()){return}if(!f){GM_addStyle(".pagination{ clear: both; } .giveaway__row-outer-wrap{ width: 19%; margin-right: 1%; float: left; } .giveaway__row-inner-wrap{ display: block; } .global__image-outer-wrap--game-medium{ margin: 0 auto !important; } .giveaway__heading{ display: block; text-align: center; } .giveaway__heading:first-of-type{ height: auto; text-overflow: ellipsis; overflow: hidden; } .giveaway__columns-full{ display: block; } .giveaway__columns-full > :not(:last-child){ margin: 0 0 5px 0; } .giveaway__columns--badges{ margin-bottom: 5px; } .giveaway__columns--badges > .giveaway__column--contributor-level:not(.giveaway__column--empty){ -webkit-box-flex: 1; -moz-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; } .giveaway__column--empty{ height: 26px; width: 0; padding: 0; margin: 0 !important; visibility: hidden; } .giveaway__links{ display: block; margin-top: 5px; } .giveaway__links a{ margin-right: 5px; } .pinned-giveaways__inner-wrap--minimized .giveaway__row-outer-wrap:nth-child(-n+5){ display: initial; } .giveaway__row--empty{ clear: both; } ")}g.find(".giveaway__columns").addClass("giveaway__columns-full");$.each(g.find(".giveaway__row-outer-wrap"),function(k,l){var h=$(l);h.find(".global__image-outer-wrap--avatar-small").remove();h.find(".giveaway__row-inner-wrap").prepend(h.find(".global__image-outer-wrap--game-medium").detach());h.find(".giveaway__summary").prepend($("<h2/>").addClass("giveaway__heading").html(h.find(".giveaway__heading__name").detach()));h.find(".giveaway__columns").before($("<div/>").addClass("giveaway__columns giveaway__columns--badges").html(h.find(".giveaway__column--width-fill").nextAll().detach()).prepend($("<div/>").addClass("giveaway__column--empty")));var j=h.find(".fa-tag").next();j.html(j.text().replace(/([\d,]+) \w+/,"$1"));j=h.find(".fa-comment").next();j.html(j.text().replace(/([\d,]+) \w+/,"$1"))});g.find(".pinned-giveaways__inner-wrap").append($("<div/>").addClass("giveaway__row--empty"))},bulkFeatured:{find:function(){switch(c.featuredGA.value){case 0:d.giveaways.bulkFeatured.hidden();break;case 1:d.giveaways.bulkFeatured.expanded();break;default:d.giveaways.bulkFeatured.injectCollapsable();break}},injectCollapsable:function(){if($(".pinned-giveaways__inner-wrap").children().length<3){return}GM_addStyle(".pinned-giveaways__button{ clear: both; } .pinned-giveaways__inner-wrap:not(.pinned-giveaways__inner-wrap--minimized){   border-radius: 4px 4px 0 0; margin-bottom: 0; }");$(".pinned-giveaways__button").off("click");$(".pinned-giveaways__button").addClass("pinned-giveaways__button-expand");
var f=$("<div/>").hide().addClass("pinned-giveaways__button").addClass("pinned-giveaways__button-collapse").html("<i class='fa fa-angle-up'></i>").appendTo(".pinned-giveaways__outer-wrap");f.on("click",function(g){$(".pinned-giveaways__inner-wrap").addClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").show();$(".pinned-giveaways__button-collapse").hide();g.preventDefault()});$(".pinned-giveaways__button-expand").on("click",function(){$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()})},hidden:function(){$(".pinned-giveaways__outer-wrap").remove()},expanded:function(){d.giveaways.bulkFeatured.injectCollapsable();$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()}},activeThreads:{find:function(){switch(c.activeTalk.value){case 0:d.giveaways.activeThreads.hidden();break;case 1:d.giveaways.activeThreads.sidebar();break;default:break}},hidden:function(){$(".widget-container.widget-container--margin-top").children().remove()},sidebar:function(){var f=$(".sidebar__navigation").last();if($(".widget-container.widget-container--margin-top").length===0){return}var g=$("<ul/>").addClass("sidebar__navigation");$.each($(".table__row-inner-wrap"),function(l,j){var k=$(j);var m=k.find(".table__column--width-fill").first();var h=m.find("h3").find("a");g.append(d.helpers.makeSideLink(h.attr("href"),h.html(),k.find(".table__column--width-small").find("a").html(),"by "+m.find("a").last().html()))});$("<h3/>").addClass("sidebar__heading").html("Active Discussions").insertAfter(f).after(g);d.giveaways.activeThreads.hidden()}}},threads:{collapseDiscussion:function(){if(!(c.collapsed.value&2)||!~location.href.indexOf("/discussion/")){return}var f=d.helpers.fromQuery("page");if(f&&f>1){$(".comment__collapse-button").first().trigger("click")}},collapseTrade:function(){if(!(c.collapsed.value&1)||!~location.href.indexOf("/trade/")){return}var f=d.helpers.fromQuery("page");if(f&&f>1){$(".comment__collapse-button").first().trigger("click")}},injectTimes:function(f){if(!~location.href.indexOf("/discussion/")&&!~location.href.indexOf("/trade/")){return}$.each(f.find(".comment__actions"),function(j,k){var n=$($(k).children().first().children()[1]);if(n.length){var l,m=n.attr("title").replace(/Edited:/,""),h=m.match(/(\w+ \d+, \d{4}|Yesterday|Today), (\d+):(\d{2})(am|pm)/i);if(h[1]==="Today"||h[1]==="Yesterday"){l=new Date();if(h[1]==="Yesterday"){l.setDate(l.getDate()-1)}}else{l=new Date(h[1])}l.setHours(+h[2]+((+h[2]<12&&h[4]=="pm")?12:0)-(+h[2]==12&&h[4]=="am"?12:0),+h[3],0,0);d.logging.debug(m+"-->"+l.toString());var p,g,o=Math.floor((new Date()-l)/1000);var g=Math.floor(o/31622400);if(g>1){p=g+" year"}else{g=Math.floor(o/2678400);if(g>1){p=g+" month"}else{g=Math.floor(o/86400);if(g>=1){p=g+" day"
}else{g=Math.floor(o/3600);if(g>=1){p=g+" hour"}else{g=Math.floor(o/60);if(g>=1){p=g+" minute"}else{p=o+" second"}}}}}n.html(" <strong>*Edited: "+p+(g==1?"":"s")+" ago</strong>")}})}},loading:{everyNew:function(f){d.giveaways.injectFlags.wishlist(f,true);d.giveaways.injectFlags.recent(f,true);d.giveaways.injectChance(f);d.giveaways.injectSearch(f,true);d.giveaways.hideEntered(f);d.giveaways.easyHide(f);d.giveaways.gridForm(f,true);d.users.profileHover(f,true);d.users.listIndication(f,true)},giveaways:function(){if(!(c.loadLists.value&8)||!d.helpers.isGAlist()){return}GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var f=d.helpers.fromQuery("page");if(f==undefined){f=1}$(".widget-container").find(".page__heading").first().after($(".pagination").detach());var g=false;e.on("scroll",function(){var h=(e.scrollTop()+$(window).height())/e.height();if(h>=0.9&&!g){g=true;f++;var i=location.href;if(~i.indexOf("?")){i=i.replace(/page=\d+?&?/,"")}else{if(location.pathname.length==1){i+="/giveaways"}i+="/search?"}d.loading.addSpinner($(".giveaway__row-outer-wrap").last());d.logging.info("Loading next page: "+f);d.logging.debug(i+"&page="+f);$.ajax({method:"GET",url:i+"&page="+f}).done(function(m){var j=$(m);d.loading.everyNew(j);j.find(".pinned-giveaways__outer-wrap").remove();var l=j.find(".giveaway__row-outer-wrap").detach();if(l.length===0){d.logging.info("No more giveaways");d.loading.removeSpinner();return}var k=j.find(".pagination");k.find(".pagination__navigation").html("Page "+f);$(".giveaway__row-outer-wrap").last().parent().append(k).append(l);g=false;d.loading.removeSpinner()})}})},trade:function(){if(!(c.loadLists.value&2)||!~location.href.indexOf("/trade/")){return}d.loading.comments()},threads:function(){if(!(c.loadLists.value&4)||!~location.href.indexOf("/discussion/")){return}d.loading.comments()},thanks:function(){if(!(c.loadLists.value&1)||!~location.href.indexOf("/giveaway/")){return}d.loading.comments()},comments:function(){GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var g=d.helpers.fromQuery("page");if(g==undefined){g=1}var f=$(".pagination__navigation").children().last().attr("data-page-number");$(".page__heading").last().after($(".pagination").detach());var h=false;e.on("scroll",function(){var i=(e.scrollTop()+$(window).height())/e.height();if(i>=0.9&&!h){h=true;if(g++<f){var j=location.href;if(~j.indexOf("?")){j=j.replace(/page=\d+?&?/,"")}else{j+="/search?"}d.loading.addSpinner($(".comments").last());d.logging.info("Loading next page: "+g+"/"+f);d.logging.debug(j+"&page="+g);$.ajax({method:"GET",url:j+"&page="+g}).done(function(m){var k=$(m);d.users.profileHover(k);d.users.listIndication(k);d.threads.injectTimes(k);var l=k.find(".pagination");l.find(".pagination__navigation").html("Page "+g);$(".comments").last().append(l).append(k.find(".comments").last().children().detach());h=false;d.loading.removeSpinner()
})}}})},addSpinner:function(f){f.after($("<div/>").addClass("pagination__loader").html("<i class='fa fa-spin fa-circle-o-notch'></i>"))},removeSpinner:function(){$(".pagination__loader").remove()},points:function(){if(c.pointInvl.value<1||isNaN(c.pointInvl.value)){return}if(c.pointInvl.value<15){d.logging.alert("Failed to apply defined points interval, using 15 seconds instead");c.pointInvl.value=15}window.setInterval(function(){d.logging.debug("Pulling new point value");$.ajax({method:"GET",url:"/about/brand-assets"}).done(function(f){$(".nav__points").html($(f).find(".nav__points").html())})},c.pointInvl.value*1000)}},users:{profileHover:function(l,h){if(!c.userDetail.value){return}var m=64,i=5;var g=360,s=160;if(!h){GM_addStyle(".user-panel__outer-wrap{ position: absolute; width: "+g+"px; height: "+s+"px; color: #21262f; } .user-panel__inner-wrap{ position: relative; width:100%; height: 100%; } .user-panel__image{ position: absolute; top: 0; left: 0; width: "+m+"px; height: "+m+"px;   border-radius: 5px; } .user-panel__corner{ position: absolute; top: "+(m+i)+"px; bottom: 0; left: 0; right: "+(g-(m+i))+"px;   padding: 5px; background-color: #465670; border-radius: 3px 0 0 3px; } .user-panel__corner .user-panel__icon-load{ font-size: 5em; color: rgba(255,255,255,0.6); } .user-panel__corner .sidebar__shortcut-inner-wrap{ display: block; } .user-panel__corner .sidebar__shortcut__whitelist{ margin: 0 0 5px 0; }.user-panel__stats{ position: absolute; top: 0; bottom: 0; left: "+(m+i)+"px; right: 0;   padding: 5px; background-color: #465670; border-radius: 3px 3px 3px 0; } .user-panel__stats .featured__heading__medium{ font-size: 16px; } .user-panel__stats .featured__heading{ margin-bottom: 0; } .user-panel__stats .featured__table__column{ margin: 0; } ")}var f=$("<div/>").addClass("global__image-outer-wrap user-panel__outer-wrap").appendTo($("body")).hide();var j=$("<div/>").addClass("user-panel__inner-wrap").appendTo(f);var p=$("<a/>").append($("<div/>").addClass("user-panel__image")).appendTo(j),k=$("<i/>").addClass("user-panel__icon-load fa fa-spin fa-circle-o-notch"),q=$("<div/>").addClass("user-panel__corner").appendTo(j),r=$("<div/>").addClass("user-panel__stats").appendTo(j);var o,n=null;l.find(".global__image-outer-wrap--avatar-small").not(".global__image-outer-wrap--missing-image").children().hover(function(t){var u=$(this);if(o){window.clearTimeout(o);o=null}o=window.setTimeout(function(){var x=u.parent();if(x.attr("href")!=n){p.attr("href",x.attr("href"));p.find("div").css("background-image",u.css("background-image"));d.helpers.applyGradients(r.html(""),"#515763 0%, #2f3540 100%");d.helpers.applyGradients(q.html(k),"#424751 0%, #2f3540 100%");$.ajax({method:"GET",url:x.attr("href")}).done(function(D){var B=$(D);n=x.attr("href");var z=B.find(".sidebar__suspension-time"),E=$("<div/>").addClass("featured__table__row__left").html(B.find(".featured__heading"));if(z.length){E.find(".featured__heading__medium").css("color","#000").attr("title","Suspension length: "+z.text())
}var C=B.find(".featured__outer-wrap--user").css("background-color"),y=B.find(".featured__table__row__right").find("a").css("color"),A=B.find(".sidebar__shortcut-inner-wrap");A.find(".js__submit-form-inner").remove();A.find("a").remove();q.html(A);d.helpers.applyGradients(q,y+" -120%, "+C+" 65%");d.users.listenForLists(x.attr("href"),true);r.append(B.find(".featured__table__column").last().prepend($("<div/>").addClass("featured__table__row").css("padding-top","0").append(E).append(B.find(".featured__table__column").first().find(".featured__table__row__right")[2])));d.helpers.applyGradients(r,y+" -20%, "+C+" 80%")})}else{d.users.listenForLists(n,true)}var v=$(t.target);var w=0;if((v.offset().left+g)>window.innerWidth){w=t.target.offsetWidth-g}f.show().css("left",v.offset().left-1-parseInt(x.css("padding-left"))+w).css("top",v.offset().top-1-parseInt(x.css("padding-top")))},250)},function(){window.clearTimeout(o)});$(".user-panel__outer-wrap").on("mouseleave",function(){f.hide();$(".sidebar__shortcut__whitelist").off("click");$(".sidebar__shortcut__blacklist").off("click")})},listIndication:function(k,i){if(!c.userLists.value||~location.pathname.indexOf("/user/")){return}if(!i){var j=c.userLists.sub.settings.userWhite.value.Foreground||"#2A2",h=c.userLists.sub.settings.userWhite.value.Background||"#FFF",g=c.userLists.sub.settings.userBlack.value.Foreground||"#C55",f=c.userLists.sub.settings.userBlack.value.Background||"#000";if(!~j.indexOf("#")){j="#"+j}if(!~h.indexOf("#")){h="#"+h}if(!~g.indexOf("#")){g="#"+g}if(!~f.indexOf("#")){f="#"+f}GM_addStyle("a.user__whitened{ background-color: "+h+"; color: "+j+" !important; border-radius: 4px; padding: 2px 4px; text-shadow: none; } a.user__blackened{ background-color: "+f+"; color: "+g+" !important; border-radius: 4px; padding: 2px 4px; text-shadow: none; } ")}d.helpers.listingPit.getList("white",function(l){d.logging.info("Applying white to "+l.length+" users");$.each(l,function(n,m){k.find("a[href='"+m+"']").not(".global__image-outer-wrap").addClass("user__whitened").attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")})});d.helpers.listingPit.getList("black",function(l){d.logging.info("Applying black to "+l.length+" users");$.each(l,function(m,n){k.find("a[href='"+n+"']").not(".global__image-outer-wrap").addClass("user__blackened").attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")})})},listenForLists:function(f,g){if(f.indexOf("/user/")!==0){f="/user/"+f}$(".sidebar__shortcut__whitelist").on("click",function(){d.helpers.listingPit.invalidateList("white");d.helpers.listingPit.getList("black",function(j){if(j.indexOf(f)>-1){d.helpers.listingPit.invalidateList("black")}});if(g){var h="a[href='"+f+"']";var i=$(h).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(h));i.attr("title","").removeClass("user__blackened").toggleClass("user__whitened").find("i").remove();if(i.hasClass("user__whitened")){i.attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")
}}});$(".sidebar__shortcut__blacklist").on("click",function(){d.helpers.listingPit.invalidateList("black");d.helpers.listingPit.getList("white",function(j){if(j.indexOf(f)>-1){d.helpers.listingPit.invalidateList("white")}});if(g){var h="a[href='"+f+"']";var i=$(h).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(h));i.attr("title","").removeClass("user__whitened").toggleClass("user__blackened").find("i").remove();if(i.hasClass("user__blackened")){i.attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")}}})}},pointless:{kccode:function(){GM_addStyle("*{ direction: rtl; } ");$(".fa").addClass("fa-spin")}}};d.settings.injectPage();d.settings.injectMenu();d.settings.invalidateOnSync();d.fixedElements.header();d.fixedElements.sidebar();d.fixedElements.footer();d.loading.trade();d.loading.threads();d.loading.thanks();d.loading.giveaways();d.loading.points();d.giveaways.injectFlags.all(e);d.giveaways.injectChance(e);d.giveaways.injectSearch(e);d.giveaways.injectNavSearch();d.giveaways.hideEntered(e);d.giveaways.easyHide(e);d.giveaways.gridForm(e);d.sidebar.removeMyGA();d.giveaways.activeThreads.find();d.threads.injectTimes(e);d.sidebar.injectSGTools();d.users.profileHover(e);d.users.listIndication(e);d.users.listenForLists($(".featured__heading__medium").text());window.setTimeout(function(){e.scroll();d.giveaways.bulkFeatured.find();d.threads.collapseDiscussion();d.threads.collapseTrade()},100);var b=[38,38,40,40,37,39,37,39,98,97],a=0;e.on("keypress",function(f){if(f.keyCode==b[a]||f.which==b[a]){if(++a==b.length){console.log("[RIBBIT] - Command received - Iniitiating sequence..");d.pointless.kccode()}}else{a=0}});console.log("[RIBBIT] - SGT Mode Activated!")})();