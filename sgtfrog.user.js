/*!
// ==UserScript==
// @name         SteamGifts Tinkerer, Featuring Refined Ostensible Gain
// @namespace    https://github.com/bberenz/sgtfrog
// @description  SteamGifts.com user controlled enchancements
// @icon         https://raw.githubusercontent.com/bberenz/sgtfrog/master/keroro.gif
// @include      *://*.steamgifts.com/*
// @version      0.6.0
// @downloadURL  https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.user.js
// @updateURL    https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.meta.js
// @require      https://code.jquery.com/jquery-1.12.3.min.js
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==
*/
(function(){var i=$(document);if($(".nav__sits").length){console.warn("[RIBBIT] User is not logged in, cannot run script.");throw new Error("No lilypad.")}var k={fixedElms:{value:GM_getValue("fixedElms",6),set:{type:"square",opt:["Header","Sidebar","Footer"]},query:"Set fixed elements:"},loadLists:{value:GM_getValue("loadLists",15),set:{type:"square",opt:["Giveaways","Discussions","Trades","Comments"]},query:"Continuously load:"},gridView:{value:GM_getValue("gridView",0),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaways in a grid view?"},featuredGA:{value:GM_getValue("featuredGA",2),set:{type:"circle",opt:["Yes","Expanded","No"]},query:"Show featured giveaways section?"},hideEntry:{value:GM_getValue("hideEntry",1),set:{type:"circle",opt:["Yes","No"]},query:"Hide entered giveaways?"},oneHide:{value:GM_getValue("oneHide",0),set:{type:"circle",opt:["Yes","No"]},query:"Skip confirmation when hiding games?"},winPercent:{value:GM_getValue("winPercent",1),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaway win percentage?"},searchSame:{value:GM_getValue("searchSame",1),set:{type:"circle",opt:["Yes","No"]},query:"Show buttons to quickly search for similar giveaways?"},newBadges:{value:GM_getValue("newBadges",1),set:{type:"circle",opt:["Yes","No"]},query:"Show additional giveaway badges?"},colorBadge:{value:GM_getValue("colorBadge",1),set:{type:"circle",opt:["Yes","No"]},query:"Recolor standard giveaway badges?"},searchNav:{value:GM_getValue("searchNav",0),set:{type:"circle",opt:["Yes","No"]},query:"Show the giveaway search bar in the top navigation?"},pointInvl:{value:GM_getValue("pointInvl",0),set:{type:"number",opt:["Seconds"],about:"Value in seconds, enter 0 to disable."},query:"Regularly update points value?"},sideMine:{value:GM_getValue("sideMine",0),set:{type:"circle",opt:["Yes","No"]},query:"Hide 'My Giveaways' in the sidebar? (Still available under nav dropdown)"},activeTalk:{value:GM_getValue("activeTalk",2),set:{type:"circle",opt:["Yes","Sidebar","No"]},query:"Show the 'Active Discussions' section?"},collapsed:{value:GM_getValue("collapsed",3),set:{type:"square",opt:["Discussions","Trades"]},query:"After first page, collapse original post:"},tracking:{value:GM_getValue("tracking",0),set:{type:"square",opt:["Discussions","Trades"]},query:"Track read comments and topics:"},userTools:{value:GM_getValue("userTools",1),set:{type:"circle",opt:["Yes","No"]},query:"Show SGTools links on user pages?"},userDetail:{value:GM_getValue("userDetail",1),set:{type:"circle",opt:["Yes","No"]},query:"Show user details on avatar hover?"},userLists:{value:GM_getValue("userLists",1),set:{type:"circle",opt:["Yes","No"]},query:"Label black-/white- listed users?",sub:{name:"Configure",settings:{userWhite:{value:JSON.parse(GM_getValue("userWhite",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Whitelisted label colors:"},userBlack:{value:JSON.parse(GM_getValue("userBlack",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Blacklisted label colors:"}}}}};
var q=JSON.parse(GM_getValue("userTags","{}"));var p={discuss:JSON.parse(GM_getValue("tracks[discuss]","{}")),trade:JSON.parse(GM_getValue("tracks[trade]","{}"))};var b=0,o={debug:function(r){if(b<-1){console.debug("[SGT DEBUG] ",r)}},info:function(r){if(b<0){console.log("[SGT INFO] ",r)}},warn:function(r){if(b<0){console.warn("[SGT WARN] ",r)}},alert:function(r){console.log("[SGT ALERT] ",r)}},d={fromQuery:function(t){var s,r={},v=/([^&=]+)=?([^&]*)/g,u=function(w){return decodeURIComponent(w.replace(/\+/g," "))};while(s=v.exec(location.search.substring(1))){r[u(s[1])]=u(s[2])}return r[t]},isGAlist:function(){return !(~location.href.indexOf("/trade")||~location.href.indexOf("/discussion")||~location.href.indexOf("/giveaway/")||~location.href.indexOf("/account/")||~location.href.indexOf("/archive")||~location.href.indexOf("/settings"))},listingPit:{cache:{wishes:{name:"cache-wish",page:"/account/steam/wishlist/search?page=",touches:".table__column__secondary-link",list:null},white:{name:"cache-white",page:"/account/manage/whitelist/search?page=",touches:".table__column__heading",list:null},black:{name:"cache-black",page:"/account/manage/blacklist/search?page=",touches:".table__column__heading",list:null}},getList:function(s,u){o.debug("Pulling list for "+s);var r=d.listingPit.cache[s];if(!r.list){var t=JSON.parse(GM_getValue(r.name,null));if(t==null){o.debug("Entering hell..");d.listingPit.callbackHell(r.page,1,r.touches,function(v){GM_setValue(r.name,JSON.stringify(v));GM_setValue(r.name+"-time",Date.now());r.list=v;u(v)})}else{o.debug("Had it saved..");r.list=t;u(t)}}else{o.debug("Already loaded..");u(r.list)}},invalidateList:function(r){o.debug("Invalidating "+r);GM_setValue(d.listingPit.cache[r].name,null)},callbackHell:function(s,u,t,r){$.ajax({method:"GET",url:s+u}).done(function(y){var w=$(y),x=w.find(".pagination__navigation").children().last().attr("data-page-number");var v=[];$.each(w.find(t),function(z,A){v.push($(A).attr("href"))});if(u<x){o.debug("Going deeper..");d.listingPit.callbackHell(s,++u,t,function(z){r($.merge(v,z))})}else{r(v)}})}},makeSideLink:function(s,r,u,t){var x=$("<li/>").addClass("sidebar__navigation__item");var v=$("<a/>").addClass("sidebar__navigation__item__link").attr("href",s).appendTo(x);var w=$("<div/>").addClass("sidebar__navigation__item__name").html(r).appendTo(v);if(t!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(t).appendTo(w)}$("<div/>").addClass("sidebar__navigation__item__underline").appendTo(v);if(u!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(u).appendTo(v)}return x},makeTopLink:function(u,t,x,v,s){var w=$("<a/>").addClass("nav__row").attr("href",u);$("<i/>").addClass("icon-"+s).addClass("fa fa-fw fa-"+v).appendTo(w);var r=$("<div/>").addClass("nav__row__summary").appendTo(w);$("<p/>").addClass("nav__row__summary__name").html(t).appendTo(r);$("<p/>").addClass("nav__row__summary__description").html(x).appendTo(r);return w},settings:{makeRow:function(A,t,z,r){var w;
switch(r.set.type){case"circle":w=d.settings.makeRadio(t,z,r);break;case"square":w=d.settings.makeCheck(t,z,r);break;case"number":case"text":w=d.settings.makeText(t,z,r);break;default:o.warn("Cannot determine options type: "+r.set.type);return}A.append(w);if(r.sub){w.find(".form__checkbox").last().after($("<div/>").addClass("form__checkbox is-selected").append($("<a/>").html(r.sub.name)).on("click",function(B){$("#sub_"+z).toggle();B.stopImmediatePropagation()}));var x="abcde";var v=$("<div/>").attr("id","sub_"+z).css("display","none").appendTo(A);var y=Object.keys(r.sub.settings);for(var u=0;u<y.length;u++){var s=y[u];if(r.sub.settings.hasOwnProperty(s)){d.settings.makeRow(v,t+x.substring(u,u+1),s,r.sub.settings[s])}}}},makeHeading:function(t,s){var r=$("<div/>").addClass("form__row");$("<div/>").addClass("form__heading").append($("<div/>").addClass("form__heading__number").html(t+".")).append($("<div/>").addClass("form__heading__text").html(s)).appendTo(r);return r},makeRadio:function(v,u,t){var x=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",u).val(t.value));for(var s=0;s<t.set.opt.length;s++){var w=t.set.opt.length-1-s;var r=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",w).append("<i class='form__checkbox__default fa fa-circle-o'></i>").append("<i class='form__checkbox__hover fa fa-circle'></i>").append("<i class='form__checkbox__selected fa fa-check-circle'></i>").append(t.set.opt[s]);if(t.value==w){r.addClass("is-selected")}else{r.addClass("is-disabled")}x.append(r)}return d.settings.makeHeading(v,t.query).append($("<div/>").addClass("form__row__indent").append(x))},makeCheck:function(u,t,s){var x=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",t).val(s.value));for(var r=0;r<s.set.opt.length;r++){var w=Math.pow(2,s.set.opt.length-1-r);var v=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",w).append("<i class='form__checkbox__default fa fa-square-o'></i>").append("<i class='form__checkbox__hover fa fa-square'></i>").append("<i class='form__checkbox__selected fa fa-check-square'></i>").append(s.set.opt[r]).on("click",function(y){var z=$(this),A=z.siblings("input");A.val(A.val()^z.attr("data-checkbox-value"));if(A.val()&z.attr("data-checkbox-value")){z.removeClass("is-disabled").addClass("is-selected")}else{z.addClass("is-disabled").removeClass("is-selected")}y.stopImmediatePropagation()});if(s.value&w){v.addClass("is-selected")}else{v.addClass("is-disabled")}x.append(v)}return d.settings.makeHeading(u,s.query).append($("<div/>").addClass("form__row__indent").append(x))},makeText:function(v,u,s){var r=$("<div/>").addClass("form__row__indent");$.each(s.set.opt,function(x,w){var z=s.value,y="";if(s.set.opt.length>1){z=s.value[w];y="_"+x}r.append($("<input/>").attr("type",s.set.type).attr("name",u+y).attr("placeholder",w).addClass("form__input-small").val(z))});var t=$("<div/>").addClass("form__input-description").html(s.set.about);return d.settings.makeHeading(v,s.query).append(r.append(t))
}},applyGradients:function(s,r){s.css("background-image","linear-gradient("+r+")").css("background-image","-moz-linear-gradient("+r+")").css("background-image","-webkit-linear-gradient("+r+")")}},g={invalidateOnSync:function(){if(!k.newBadges.value||!~location.href.indexOf("/profile/sync")){return}$(".form__sync-default").on("click",function(){d.listingPit.invalidateList("wishes")})},injectMenu:function(t){o.debug("Adding custom navigation");var s=$("<div/>").addClass("nav__button-container");$("<a/>").addClass("nav__button nav__buton--is-dropdown").attr("href","/ąccount/settings/ribbit").html("SGT frog").appendTo(s);$("<div/>").addClass("nav__button nav__button--is-dropdown-arrow").html("<i class='fa fa-angle-down'></i>").appendTo(s).on("click",function(w){var v=$(this).hasClass("is-selected");$("nav .nav__button").removeClass("is-selected"),$("nav .nav__relative-dropdown").addClass("is-hidden"),v||$(this).addClass("is-selected").siblings(".nav__relative-dropdown").removeClass("is-hidden"),w.stopImmediatePropagation()});var u=$("<div/>").addClass("nav__relative-dropdown is-hidden").appendTo(s);$("<div/>").addClass("nav__absolute-dropdown").append(d.makeTopLink("/ąccount/settings/ribbit","Settings","Adjust tool functionality.","gears","grey")).append(d.makeTopLink("https://github.com/bberenz/sgtfrog/issues","Feedback","Report an issue or request a feature.","github","green")).append(d.makeTopLink("https://www.steamgifts.com/discussion/4C3Cl/userscript-steamgifts-tinkerer-featuring-refined-ostensible-gain","Discussion","View the SteamGifts discussion thread.","square-o","blue")).appendTo(u);$(".nav__right-container").find(".nav__button-container:not(.nav__button-container--notification)").last().before(s);var r=d.makeSideLink("/ąccount/settings/ribbit","SGT frog");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().after(r);if(t){r.addClass("is-selected");r.find(".sidebar__navigation__item__name").before("<i class='fa fa-caret-right'></i>")}},injectPage:function(){if(location.pathname==="/%C4%85ccount/settings/ribbit"){o.info("Creating custom settings page");GM_addStyle("body{ background-image: none; background-color: #95A4C0; }");var r=$("style").detach();$("html").empty();$.ajax({method:"GET",url:"/account/settings/sales"}).done(function(x){var v=x.substring(x.indexOf("<head>")+6,x.indexOf("</head>")).replace(/<script [\s\S]+?<\/script>/g,"");$("<head/>").appendTo("html").append(v).append("<script src='https://cdn.steamgifts.com/js/minified.js'><\/script>");$("<body/>").appendTo("html").append(x.substring(x.indexOf("<body>")+6,x.indexOf("</body>")));r.appendTo("html");$(".page__heading__breadcrumbs").children("a").last().html("Sgt Frog").attr("href","/ąccount/settings/ribbit");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().removeClass("is-selected").find("i").remove();$("title").html("Account - Settings - Ribbit");var t=$(".form__rows");t.empty();var w=Object.keys(k);for(var u=0;u<w.length;u++){var s=w[u];
if(k.hasOwnProperty(s)){d.settings.makeRow(t,u+1,s,k[s])}}$("<div/>").addClass("form__submit-button").html("<i class='fa fa-arrow-circle-right'></i> Save Changes").on("click",function(){g.save(k)}).appendTo(t);o.debug("Creation complete");window.setTimeout(function(){g.injectMenu(true);e.injectNavSearch();h.header();h.sidebar();h.footer();i.scroll()},500)})}},save:function(x){var v=function(A,B){o.debug("Setting "+A+" to "+B);GM_setValue(A,B)};var z=Object.keys(x);for(var u=0;u<z.length;u++){var s=z[u];if(x.hasOwnProperty(s)){if(x[s].set.type=="text"&&x[s].set.opt.length>1){var y={};for(var t=0;t<x[s].set.opt.length;t++){var r=$("input[name='"+s+"_"+t+"']");y[x[s].set.opt[t]]=r.val()}v(s,JSON.stringify(y))}else{var w=$("input[name='"+s+"']");v(s,+w.val())}if(x[s].sub){g.save(x[s].sub.settings)}}}o.info("Saved new settings");window.scrollTo(0,0);location.reload()}},h={header:function(){if(!(k.fixedElms.value&4)){return}GM_addStyle("header.fixed{ position: fixed; top: 0; width: 100%; z-index: 100; } .left-above{ margin-top: 39px !important; }");$("header").addClass("fixed");var r=$(".featured__container");if(r.length>0){r.addClass("left-above")}else{$(".page__outer-wrap").addClass("left-above")}},sidebar:function(){if(!(k.fixedElms.value&2)){return}var u=k.fixedElms.value&4?64:25;GM_addStyle(".sidebar .fixed{ position: fixed; top: "+u+"px; }");var s=$(".sidebar"),r=$("<div/>").addClass("sidebar__outer-wrap"),t=$(".sidebar__mpu");s.children().detach().appendTo(r);r.appendTo(s);i.on("scroll",function(){var v=$(".featured__container").height()+64;if(i.scrollTop()>(v-u)){s.children().addClass("fixed");t.hide()}else{s.children().removeClass("fixed");t.show()}});r.css("width",s.css("min-width")).css("min-width",s.css("min-width")).css("max-width",s.css("max-width"))},footer:function(){if(!(k.fixedElms.value&1)){return}GM_addStyle(".footer__outer-wrap.fixed{ position: fixed; bottom: 0; width: 100%;   background-color: #95a4c0; z-index: 100; } .left-below{ margin-bottom: 45px; }");$(".footer__outer-wrap").addClass("fixed");$(".page__outer-wrap").addClass("left-below")}},f={addSpinner:function(r){r.after($("<div/>").addClass("pagination__loader").html("<i class='fa fa-spin fa-circle-o-notch'></i>"))},removeSpinner:function(){$(".pagination__loader").remove()},everyNew:function(r){e.injectFlags.wishlist(r,true);e.injectFlags.recent(r,true);e.injectChance(r);e.injectSearch(r,true);e.hideEntered(r);e.easyHide(r);e.gridForm(r,true);c.profileHover(r,true);c.tagging.show(r,true);c.listIndication(r,true)},giveaways:function(){if(!(k.loadLists.value&8)||!d.isGAlist()){return}GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var s=d.fromQuery("page");if(s==undefined){s=1}$(".widget-container").find(".page__heading").first().after($(".pagination").detach());var r=false;i.on("scroll",function(){var t=(i.scrollTop()+$(window).height())/i.height();if(t>=0.9&&!r){r=true;s++;var u=location.href;if(~u.indexOf("?")){u=u.replace(/page=\d+?&?/,"")
}else{if(location.pathname.length==1){u+="/giveaways"}u+="/search?"}o.info("Loading next page: "+s);f.addSpinner($(".giveaway__row-outer-wrap").last());o.debug(u+"&page="+s);$.ajax({method:"GET",url:u+"&page="+s}).done(function(y){var v=$(y);f.everyNew(v);v.find(".pinned-giveaways__outer-wrap").remove();var x=v.find(".giveaway__row-outer-wrap").detach();if(x.length===0){o.info("No more giveaways");f.removeSpinner();return}var w=v.find(".pagination");w.find(".pagination__navigation").html("Page "+s);$(".giveaway__row-outer-wrap").last().parent().append(w).append(x);r=false;f.removeSpinner()})}})},trade:function(){if(!(k.loadLists.value&2)||!~location.href.indexOf("/trade/")){return}f.comments()},threads:function(){if(!(k.loadLists.value&4)||!~location.href.indexOf("/discussion/")){return}f.comments()},thanks:function(){if(!(k.loadLists.value&1)||!~location.href.indexOf("/giveaway/")){return}f.comments()},comments:function(){GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var t=d.fromQuery("page");if(t==undefined){t=1}var s=$(".pagination__navigation").children().last().attr("data-page-number");$(".page__heading").last().after($(".pagination").detach());var r=false;i.on("scroll",function(){var u=(i.scrollTop()+$(window).height())/i.height();if(u>=0.9&&!r){r=true;if(t++<s){var v=location.href;if(~v.indexOf("?")){v=v.replace(/page=\d+?&?/,"")}else{v+="/search?"}f.addSpinner($(".comments").last());o.info("Loading next page: "+t+"/"+s);o.debug(v+"&page="+t);$.ajax({method:"GET",url:v+"&page="+t}).done(function(y){var w=$(y);c.profileHover(w,true);c.tagging.show(w,true);c.listIndication(w,true);m.injectTimes(w);m.tracking.all(w);var x=w.find(".pagination");x.find(".pagination__navigation").html("Page "+t);$(".comments").last().append(x).append(w.find(".comments").last().children().detach());r=false;f.removeSpinner()})}}})},points:function(){if(k.pointInvl.value<1||isNaN(k.pointInvl.value)){return}if(k.pointInvl.value<15){o.alert("Failed to apply defined points interval, using 15 seconds instead");k.pointInvl.value=15}window.setInterval(function(){o.debug("Pulling new point value");$.ajax({method:"GET",url:"/about/brand-assets"}).done(function(r){$(".nav__points").html($(r).find(".nav__points").html())})},k.pointInvl.value*1000)}},a={removeMyGA:function(){if(!k.sideMine.value){return}var s=$(".sidebar");var r=s.find(".sidebar__heading").last();if(r.html()==="My Giveaways"){r.remove();s.find(".sidebar__navigation").last().remove()}},injectSGTools:function(){if(!k.userTools.value||!~location.pathname.indexOf("/user/")){return}var s=location.href.split("/")[4];o.debug("Found user: "+s);var r=$(".sidebar__navigation").last(),t=$("<ul/>").append(d.makeSideLink("http://www.sgtools.info/sent/"+s,"Real Value Sent").find("a").attr("target","_check"),d.makeSideLink("http://www.sgtools.info/won/"+s,"Real Value Won").find("a").attr("target","_check"),d.makeSideLink("http://www.sgtools.info/nonactivated/"+s,"Non-Activated").find("a").attr("target","_check"),d.makeSideLink("http://www.sgtools.info/multiple/"+s,"Multi Wins").find("a").attr("target","_check"));
$("<h3/>").html("SG Tools").addClass("sidebar__heading").insertAfter(r).after(t.addClass("sidebar__navigation"))}},e={injectFlags:{all:function(r){if(k.newBadges.value){e.injectFlags.wishlist(r);e.injectFlags.recent(r)}if(k.colorBadge.value){e.injectFlags.invite();e.injectFlags.region();e.injectFlags.whitelist();e.injectFlags.group()}},wishlist:function(u,s){var r=$(".giveaway__row-outer-wrap");if(r.length>0){if(!s){GM_addStyle(".giveaway__column--wish{ background-image: linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -moz-linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -webkit-linear-gradient(#FFFACF 0%, #FFF176 100%);   border-color: #EDCCBE #F0C2AF #DEAB95 #F2C4B1 !important; color: #F57F17;   box-shadow: none !important; }")}var t=$("<div/>").addClass("giveaway__column--wish").attr("title","Wishlist");$("<i/>").addClass("fa fa-fw fa-star").appendTo(t);if(Date.now()-GM_getValue("cache-wish-time",0)>(24*60*60*1000)){d.listingPit.invalidateList("wishes")}d.listingPit.getList("wishes",function(v){o.info("Applying badges for "+v.length+" wishes");$.each(v,function(x,z){var w=u.find("a[href='"+z+"']").parent().parent();var y=w.find(".giveaway__columns--badges");if(y.length){y.prepend(t.clone())}else{w.find(".giveaway__column--width-fill").after(t.clone())}})})}},recent:function(t,r){if(!r){GM_addStyle(".giveaway__column--new{   background-image: linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -moz-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -webkit-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   border-color: #FFCCBC #FFAB91 #FF8A65 #FFAB91 !important; color: #BF360C;   box-shadow: none !important; }")}var s=$("<div/>").addClass("giveaway__column--new").attr("title","New");$("<i/>").addClass("fa fa-fw fa-fire").appendTo(s);$.each(t.find(".giveaway__column--width-fill").find("span"),function(u,x){var w=$(x);var v=w.html();if(~v.indexOf("second")||~v.indexOf("minute")){w.parent().parent().find(".giveaway__column--width-fill").after(s.clone())}})},invite:function(){GM_addStyle(".giveaway__column--invite-only{ background-image: linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -moz-linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -webkit-linear-gradient(#FFCDD2 0%, #F49B95 100%);   border-color: #ef9a9a #e57373 #ef5350 #e57373 !important; color: #950000; }")},region:function(){GM_addStyle(".giveaway__column--region-restricted{ background-image: linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -moz-linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -webkit-linear-gradient(#D7CCC8 0%, #A18F89 100%);   border-color: #BDBDBD #9E9E9E #757575 #9E9E9E !important; color: #5D4037; }")},whitelist:function(){GM_addStyle(".giveaway__column--whitelist{ background-image: linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -moz-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -webkit-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   color: #D81B60 !important; }")
},group:function(){GM_addStyle(".giveaway__column--group{ background-image: linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -moz-linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -webkit-linear-gradient(#DCEDC8 0%, #AED581 100%); ")}},injectChance:function(s){if(!k.winPercent.value){return}var r=function(t,u){return"<i class='fa fa-bar-chart'></i> <span>"+Math.min(100,(1/t)*u*100).toFixed(3)+"% chance</span>"};$.each(s.find(".giveaway__row-outer-wrap"),function(u,z){var x=$(z);var t=x.find(".fa-tag").next().html().split(/\s/)[0].replace(/,/g,"");var w=x.find(".giveaway__columns").children().first().find("span").html().substr(0,5);if(w!=="Ended"&&!x.find(".giveaway__row-inner-wrap").hasClass("is-faded")){t++}var y=1;var A=x.find(".giveaway__heading__thin").first().html();if(A&&~A.indexOf("Copies")){y=+(A.replace(/([\(\),\s]|Copies)/g,""))}var v=$("<div/>").html(r(t,y));x.find(".giveaway__columns").children().first().after(v)});$.each(s.find(".featured__columns"),function(w,y){var v=s.find(".live__entry-count");if(!v||v.length===0){return}var t=v.html().replace(/,/g,"");var u=s.find(".sidebar__entry-insert");if(u&&u.length>0&&!u.hasClass("is-hidden")){t++}var z=1;var A=s.find(".featured__heading__small").first().html();if(~A.indexOf("Copies")){z=+(A.replace(/([\(\),\s]|Copies)/g,""))}var x=$("<div/>").addClass("featured__column").html(r(t,z));$(y).children().first().after(x)})},injectSearch:function(u,s){if(!k.searchSame.value){return}$.each(u.find(".giveaway__heading"),function(v,x){var w=$(x);$("<a/>").addClass("giveaway__icon").html("<i class='fa fa-search-plus'></i>").attr("title","Find similar giveaways").attr("href","/giveaways/search?q="+w.find(".giveaway__heading__name").html()).appendTo(w)});if(~location.href.indexOf("/giveaway/")){if(!s){GM_addStyle(".sidebar__shortcut-inner-wrap div{ padding: 0; } .sidebar__shortcut-inner-wrap .sidebar__error{ border-color: #f0d1dc #e5bccc #d9a7ba #ebbecf; }")}var r=$(".sidebar__navigation").parent();var t=r.children().first().not(".sidebar__mpu").detach();if(!t.hasClass("sidebar__error")){t.css("background-image","none").css("border","none")}else{d.applyGradients(t,"#f7edf1 0%, #e6d9de 100%")}$("<div/>").addClass("sidebar__shortcut-inner-wrap").append($("<a/>").addClass("sidebar__entry-loading").css("max-width",(t.length>0?"33%":"100%")).html("<i class='fa fa-search'></i> Find Similar").attr("href","/giveaways/search?q="+$(".featured__heading__medium").html())).append(t).appendTo($("<div/>").addClass("sidebar__shortcut-outer-wrap").prependTo(r))}},injectNavSearch:function(){if(!k.searchNav.value){return}var r=$("<div/>").addClass("sidebar__search-container").css("margin","0 5px 0 0").css("height","inherit").append($("<input class='sidebar__search-input' placeholder='Search Giveaways...' value='' type='text' />").on("keypress",function(s){if(s.which===13){location.href="/giveaways/search?q="+$(this).val();s.stopImmediatePropagation()}})).append("<i class='fa fa-search'></i>");$(".nav__left-container").prepend(r)
},hideEntered:function(r){if(!k.hideEntry.value||~location.href.indexOf("/giveaways/won")){return}r.find(".is-faded").parent(".giveaway__row-outer-wrap").remove()},easyHide:function(r){if(!k.oneHide.value){return}r.find("[data-popup='popup--hide-games']").on("click",function(s){window.setTimeout(function(){$(".js__submit-hide-games").click()},100)})},gridForm:function(s,r){if(!k.gridView.value||!d.isGAlist()){return}if(!r){GM_addStyle(".pagination{ clear: both; } .giveaway__row-outer-wrap{ width: 19%; margin-right: 1%; float: left; } .giveaway__row-inner-wrap{ display: block; } .global__image-outer-wrap--game-medium{ width: initial; margin: 0 auto !important; } .giveaway__heading{ display: block; text-align: center; } .giveaway__heading:first-of-type{ height: auto; text-overflow: ellipsis; overflow: hidden; } .giveaway__columns-full{ display: block; } .giveaway__columns-full > :not(:last-child){ margin: 0 0 5px 0; } .giveaway__columns--badges{ margin-bottom: 5px; } .giveaway__columns--badges > .giveaway__column--contributor-level:not(.giveaway__column--empty){ -webkit-box-flex: 1; -moz-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; } .giveaway__column--empty{ height: 26px; width: 0; padding: 0; margin: 0 !important; visibility: hidden; } .giveaway__links{ display: block; margin-top: 5px; } .giveaway__links a{ margin-right: 5px; } .pinned-giveaways__inner-wrap--minimized .giveaway__row-outer-wrap:nth-child(-n+5){ display: initial; } .giveaway__row--empty{ clear: both; } ")}s.find(".giveaway__columns").addClass("giveaway__columns-full");$.each(s.find(".giveaway__row-outer-wrap"),function(v,w){var t=$(w);t.find(".global__image-outer-wrap--avatar-small").remove();t.find(".giveaway__row-inner-wrap").prepend(t.find(".global__image-outer-wrap--game-medium").detach());t.find(".giveaway__summary").prepend($("<h2/>").addClass("giveaway__heading").html(t.find(".giveaway__heading__name").detach()));t.find(".giveaway__columns").before($("<div/>").addClass("giveaway__columns giveaway__columns--badges").html(t.find(".giveaway__column--width-fill").nextAll().detach()).prepend($("<div/>").addClass("giveaway__column--empty")));var u=t.find(".fa-tag").next();u.html(u.text().replace(/([\d,]+) \w+/,"$1"));u=t.find(".fa-comment").next();u.html(u.text().replace(/([\d,]+) \w+/,"$1"))});s.find(".pinned-giveaways__inner-wrap").append($("<div/>").addClass("giveaway__row--empty"))},bulkFeatured:{find:function(){switch(k.featuredGA.value){case 0:e.bulkFeatured.hidden();break;case 1:e.bulkFeatured.expanded();break;default:e.bulkFeatured.injectCollapsable();break}},injectCollapsable:function(){if($(".pinned-giveaways__inner-wrap").children().length<3){return}GM_addStyle(".pinned-giveaways__button{ clear: both; } .pinned-giveaways__inner-wrap:not(.pinned-giveaways__inner-wrap--minimized){   border-radius: 4px 4px 0 0; margin-bottom: 0; }");$(".pinned-giveaways__button").off("click");$(".pinned-giveaways__button").addClass("pinned-giveaways__button-expand");var r=$("<div/>").hide().addClass("pinned-giveaways__button").addClass("pinned-giveaways__button-collapse").html("<i class='fa fa-angle-up'></i>").appendTo(".pinned-giveaways__outer-wrap");
r.on("click",function(s){$(".pinned-giveaways__inner-wrap").addClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").show();$(".pinned-giveaways__button-collapse").hide();s.preventDefault()});$(".pinned-giveaways__button-expand").on("click",function(){$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()})},hidden:function(){$(".pinned-giveaways__outer-wrap").remove()},expanded:function(){e.bulkFeatured.injectCollapsable();$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()}},activeThreads:{find:function(){switch(k.activeTalk.value){case 0:e.activeThreads.hidden();break;case 1:e.activeThreads.sidebar();break;default:break}},hidden:function(){$(".widget-container.widget-container--margin-top").children().remove()},sidebar:function(){var r=$(".sidebar__navigation").last();if($(".widget-container.widget-container--margin-top").length===0){return}var s=$("<ul/>").addClass("sidebar__navigation");$.each($(".table__row-inner-wrap"),function(w,u){var v=$(u);var x=v.find(".table__column--width-fill").first();var t=x.find("h3").find("a");s.append(d.makeSideLink(t.attr("href"),t.html(),v.find(".table__column--width-small").find("a").html(),"by "+x.find("a").last().html()))});$("<h3/>").addClass("sidebar__heading").html("Active Discussions").insertAfter(r).after(s);e.activeThreads.hidden()}}},m={collapseDiscussion:function(){if(!(k.collapsed.value&2)||!~location.href.indexOf("/discussion/")){return}var r=d.fromQuery("page");if(r&&r>1){$(".comment__collapse-button").first().trigger("click")}},collapseTrade:function(){if(!(k.collapsed.value&1)||!~location.href.indexOf("/trade/")){return}var r=d.fromQuery("page");if(r&&r>1){$(".comment__collapse-button").first().trigger("click")}},injectTimes:function(r){if(!~location.href.indexOf("/discussion/")&&!~location.href.indexOf("/trade/")){return}$.each(r.find(".comment__actions"),function(u,v){var y=$($(v).children().first().children()[1]);if(y.length){var w,x=y.attr("title").replace(/Edited:/,""),t=x.match(/(\w+ \d+, \d{4}|Yesterday|Today), (\d+):(\d{2})(am|pm)/i);if(t[1]==="Today"||t[1]==="Yesterday"){w=new Date();if(t[1]==="Yesterday"){w.setDate(w.getDate()-1)}}else{w=new Date(t[1])}w.setHours(+t[2]+((+t[2]<12&&t[4]=="pm")?12:0)-(+t[2]==12&&t[4]=="am"?12:0),+t[3],0,0);o.debug(x+"-->"+w.toString());var A,s,z=Math.floor((new Date()-w)/1000);var s=Math.floor(z/31622400);if(s>1){A=s+" year"}else{s=Math.floor(z/2678400);if(s>1){A=s+" month"}else{s=Math.floor(z/86400);if(s>=1){A=s+" day"}else{s=Math.floor(z/3600);if(s>=1){A=s+" hour"}else{s=Math.floor(z/60);if(s>=1){A=s+" minute"}else{A=z+" second"}}}}}y.html(" <strong>*Edited: "+A+(s==1?"":"s")+" ago</strong>")}})},tracking:{all:function(r){if((k.tracking.value&2)&&~location.pathname.indexOf("/discussions")){m.tracking.lists("discuss")
}if((k.tracking.value&1)&&~location.pathname.indexOf("/trades")){m.tracking.lists("trade")}if((k.tracking.value&2)&&~location.pathname.indexOf("/discussion/")){m.tracking.posts("discuss",r)}if((k.tracking.value&1)&&~location.pathname.indexOf("/trade/")){m.tracking.posts("trade",r)}},lists:function(s){var r=$(".table__row-outer-wrap");o.debug("Found "+r.length+" rows");$.each(r,function(v,y){var x=$(y).find(".table__column--width-small").find("a");var u=x.attr("href").indexOf("/",1)+1;var t=x.attr("href").substring(u,u+5);var w="Unread";if(p[s][t]){w="+"+(+(x.text().replace(/,/g,""))-p[s][t].length)}if(w!="+0"){x.append(" <span class='icon-green'>("+w+")</span>")}})},posts:function(v,u){var r=location.href.split("/")[4];if(!p[v][r]){p[v][r]=[]}o.debug("Looking for unread posts in "+r);var t=0;var s=u.find(".comment");$.each(s,function(x,A){var w=$(A).find(".comment__summary").first();var z=w.attr("id");if(z&&!~p[v][r].indexOf(z)){p[v][r].push(z);var y=w.find(".comment__actions").find("span");y.addClass("icon-green").attr("title","New "+y.attr("title"));t++}});o.info("Found "+t+" unread posts");GM_setValue("tracks["+v+"]",JSON.stringify(p[v]))}}},c={profileHover:function(x,t){if(!k.userDetail.value){return}var y=64,u=5;var s=360,E=160;if(!t){GM_addStyle(".user-panel__outer-wrap{ position: absolute; width: "+s+"px; height: "+E+"px; color: #21262f; } .user-panel__inner-wrap{ position: relative; width:100%; height: 100%; } .user-panel__image{ position: absolute; top: 0; left: 0; width: "+y+"px; height: "+y+"px;   border-radius: 5px; } .user-panel__corner{ position: absolute; top: "+(y+u)+"px; bottom: 0; left: 0; right: "+(s-(y+u))+"px;   padding: 5px; background-color: #465670; border-radius: 3px 0 0 3px; } .user-panel__corner .user-panel__icon-load{ font-size: 5em; color: rgba(255,255,255,0.6); } .user-panel__corner .sidebar__shortcut-inner-wrap{ display: block; } .user-panel__corner .sidebar__shortcut__whitelist{ margin: 0 0 5px 0; }.user-panel__stats{ position: absolute; top: 0; bottom: 0; left: "+(y+u)+"px; right: 0;   padding: 5px; background-color: #465670; border-radius: 3px 3px 3px 0; } .user-panel__stats .featured__heading__medium{ font-size: 16px; } .user-panel__stats .featured__heading{ margin-bottom: 0; } .user-panel__stats .featured__table__column{ margin: 0; } ")}var r=$("<div/>").addClass("global__image-outer-wrap user-panel__outer-wrap").appendTo($("body")).hide();var v=$("<div/>").addClass("user-panel__inner-wrap").appendTo(r);var B=$("<a/>").addClass("user-panel__link").append($("<div/>").addClass("user-panel__image")).appendTo(v),w=$("<i/>").addClass("user-panel__icon-load fa fa-spin fa-circle-o-notch"),C=$("<div/>").addClass("user-panel__corner").appendTo(v),D=$("<div/>").addClass("user-panel__stats").appendTo(v);var A,z=null;x.find(".global__image-outer-wrap--avatar-small").not(".global__image-outer-wrap--missing-image").children().hover(function(F){var G=$(this);if(A){window.clearTimeout(A);A=null}A=window.setTimeout(function(){var J=G.parent();
if(J.attr("href")!=z){B.attr("href",J.attr("href"));B.find("div").css("background-image",G.css("background-image"));d.applyGradients(D.html(""),"#515763 0%, #2f3540 100%");d.applyGradients(C.html(w),"#424751 0%, #2f3540 100%");$.ajax({method:"GET",url:J.attr("href")}).done(function(Q){var O=$(Q);z=J.attr("href");var M=O.find(".sidebar__suspension-time"),R=$("<div/>").addClass("featured__table__row__left").html(O.find(".featured__heading"));if(M.length){R.find(".featured__heading__medium").css("color","#000").attr("title","Suspension length: "+M.text())}var P=O.find(".featured__outer-wrap--user").css("background-color"),K=O.find(".featured__table__row__right").find("a").css("color"),N=O.find(".sidebar__shortcut-inner-wrap");N.find(".js__submit-form-inner").remove();N.find("a").remove();C.html(N);d.applyGradients(C,K+" -120%, "+P+" 65%");D.append(O.find(".featured__table__column").last().prepend($("<div/>").addClass("featured__table__row").css("padding-top","0").append(R).append(O.find(".featured__table__column").first().find(".featured__table__row__right")[2])));d.applyGradients(D,K+" -20%, "+P+" 80%");var L=J.attr("href");c.listenForLists(L,true);c.tagging.injectEditor(L,true)})}else{c.listenForLists(z,true)}var H=$(F.target);var I=0;if((H.offset().left+s)>window.innerWidth){I=F.target.offsetWidth-s}r.show().css("left",H.offset().left-1-parseInt(J.css("padding-left"))+I).css("top",H.offset().top-1-parseInt(J.css("padding-top")))},250)},function(){window.clearTimeout(A)});$(".user-panel__outer-wrap").on("mouseleave",function(){r.hide();$(".sidebar__shortcut__whitelist").off("click");$(".sidebar__shortcut__blacklist").off("click")})},tagging:{show:function(s,r){if(~location.pathname.indexOf("/user/")){return}if(!r){GM_addStyle(".user__tagged{ text-decoration: none; border-radius: 4px; padding: 2px 4px; margin-left: .5em; background-color: rgba(0,0,0,.01);   text-shadow: none; box-shadow: 1px 1px 1px rgba(0,0,0,0.5) inset, -1px -1px 1px rgba(255,255,255,0.5) inset; } ")}$.each(Object.keys(q),function(t,u){s.find("a[href='/user/"+u+"']").not(".global__image-outer-wrap").append($("<span/>").addClass("user__tagged").html("<i class='fa fa-tag fa-flip-horizontal'></i> "+q[u]))})},injectEditor:function(s,u){if(!~location.pathname.indexOf("/user/")&&!u){return}if(~s.indexOf("/user/")){s=s.substring(6)}if(s==$(".nav__avatar-outer-wrap").attr("href").substring(6)){return}var r=q[s]||"Add User Tag",t="<i class='fa fa-tag fa-flip-horizontal' style='font-size: 14px;'></i> ";$("<div/>").attr("href","#").html("<a>"+t+r+"</a>").css("color",$(".featured__table__row__right").find("a").css("color")).on("click",function(w){var v=$(this);if(v.children("input").length){return}v.html("<input type='text' placeholder='User Tag' value='"+(q[s]||"")+"' maxlength='16' />").on("keypress",function(y){var z=$(this),x=y.which||y.keyCode;if(x==13){var A=$(this).children("input").val();v.html("<a>"+t+(A||"Add User Tag")+"</a>");$("a[href='/user/"+s+"']").find(".user__tagged").remove();
if(A){q[s]=A;if(u){$("a[href='/user/"+s+"']").not(".global__image-outer-wrap").append($("<span/>").addClass("user__tagged").html("<i class='fa fa-tag fa-flip-horizontal'></i> "+q[s]));$(".user-panel__outer-wrap").find(".user__tagged").remove()}}else{delete q[s]}GM_setValue("userTags",JSON.stringify(q));z.off("keypress")}else{if(x==27){v.html("<a>"+t+(q[s]||"Add User Tag")+"</a>");z.off("keypress")}}});v.find("input").select().focus().on("blur",function(){v.html("<a>"+t+r+"</a>");$(this).parent().off("keypress")})}).insertAfter((u?".user-panel__outer-wrap ":"")+".featured__heading__medium")}},listIndication:function(w,u){if(!k.userLists.value||~location.pathname.indexOf("/user/")){return}if(!u){var v=k.userLists.sub.settings.userWhite.value.Foreground||"#2A2",t=k.userLists.sub.settings.userWhite.value.Background||"#FFF",s=k.userLists.sub.settings.userBlack.value.Foreground||"#C55",r=k.userLists.sub.settings.userBlack.value.Background||"#000";if(!~v.indexOf("#")){v="#"+v}if(!~t.indexOf("#")){t="#"+t}if(!~s.indexOf("#")){s="#"+s}if(!~r.indexOf("#")){r="#"+r}GM_addStyle("a.user__whitened{ background-color: "+t+"; color: "+v+" !important; border-radius: 4px; padding: 3px 5px; text-shadow: none; } a.user__blackened{ background-color: "+r+"; color: "+s+" !important; border-radius: 4px; padding: 3px 5px; text-shadow: none; } ")}d.listingPit.getList("white",function(x){o.info("Applying white to "+x.length+" users");$.each(x,function(z,y){w.find("a[href='"+y+"']").not(".global__image-outer-wrap").addClass("user__whitened").attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")})});d.listingPit.getList("black",function(x){o.info("Applying black to "+x.length+" users");$.each(x,function(y,z){w.find("a[href='"+z+"']").not(".global__image-outer-wrap").addClass("user__blackened").attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")})})},listenForLists:function(r,s){if(r.indexOf("/user/")!==0){r="/user/"+r}$(".sidebar__shortcut__whitelist").on("click",function(){d.listingPit.invalidateList("white");d.listingPit.getList("black",function(v){if(v.indexOf(r)>-1){d.listingPit.invalidateList("black")}});if(s){var t="a[href='"+r+"']",u=$(t).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(t));u.attr("title","").removeClass("user__blackened").toggleClass("user__whitened").find("i").not(".fa-tag").remove();if(u.hasClass("user__whitened")){u.attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")}}});$(".sidebar__shortcut__blacklist").on("click",function(){d.listingPit.invalidateList("black");d.listingPit.getList("white",function(v){if(v.indexOf(r)>-1){d.listingPit.invalidateList("white")}});if(s){var t="a[href='"+r+"']";var u=$(t).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(t));u.attr("title","").removeClass("user__whitened").toggleClass("user__blackened").find("i").not(".fa-tag").remove();if(u.hasClass("user__blackened")){u.attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")
}}})}},l={kccode:function(){GM_addStyle("*{ direction: rtl; } ");$(".fa").addClass("fa-spin")}};(function(){g.injectPage();g.injectMenu();g.invalidateOnSync();h.header();h.sidebar();h.footer();f.trade();f.threads();f.thanks();f.giveaways();f.points();e.injectFlags.all(i);e.injectChance(i);e.injectSearch(i);e.injectNavSearch();e.hideEntered(i);e.easyHide(i);e.gridForm(i);e.activeThreads.find();a.removeMyGA();a.injectSGTools();m.injectTimes(i);m.tracking.all(i);c.profileHover(i);c.tagging.show(i);c.tagging.injectEditor($(".featured__heading__medium").text());c.listIndication(i);c.listenForLists($(".featured__heading__medium").text());window.setTimeout(function(){i.scroll();e.bulkFeatured.find();m.collapseDiscussion();m.collapseTrade()},100)})();var j=[38,38,40,40,37,39,37,39,98,97],n=0;i.on("keypress",function(r){if(r.keyCode==j[n]||r.which==j[n]){if(++n==j.length){console.log("[RIBBIT] - Command received - Iniitiating sequence..");l.kccode()}}else{n=0}});console.log("[RIBBIT] - SGT Mode Activated!")})();