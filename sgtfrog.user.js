/*!
// ==UserScript==
// @name         SteamGifts Tinkerer, Featuring Refined Ostensible Gain
// @namespace    https://github.com/bberenz/sgtfrog
// @description  SteamGifts.com user controlled enchancements
// @icon         https://raw.githubusercontent.com/bberenz/sgtfrog/master/keroro.gif
// @include      *://*.steamgifts.com/*
// @version      0.4.0.2
// @downloadURL  https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.user.js
// @updateURL    https://raw.githubusercontent.com/bberenz/sgtfrog/master/sgtfrog.meta.js
// @require      https://code.jquery.com/jquery-1.12.3.min.js
// @grant        GM_addStyle
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// ==/UserScript==
*/
(function(){var f=$(document);if($(".nav__sits").length){console.warn("[RIBBIT] User is not logged in, cannot run script.");throw new Error("No lilypad.")}(function(){if(GM_getValue("stickHead")===undefined){return}console.log("ONE-TIME - converting old settings values");var g=GM_getValue("stickHead",1)*4|GM_getValue("stickSide",1)*2|GM_getValue("stickFoot",0)*1;GM_setValue("fixedElms",g);GM_deleteValue("stickHead");GM_deleteValue("stickSide");GM_deleteValue("stickFoot");var i=GM_getValue("loadGA",1)*8|GM_getValue("loadThread",0)*4|GM_getValue("loadTrade",0)*2|GM_getValue("loadComment",0)*1;GM_setValue("loadLists",i);GM_deleteValue("loadGA");GM_deleteValue("loadThread");GM_deleteValue("loadTrade");GM_deleteValue("loadComment");var j=GM_getValue("collapseThread",1)*2|GM_getValue("collapseTrade",1)*1;GM_setValue("collapsed",j);GM_deleteValue("collapseThread");GM_deleteValue("collapseTrade");var h=GM_getValue("points",0);if(h){GM_setValue("pointInvl",(30/(d.points.value)))}GM_deleteValue("points");GM_setValue("colorBadge",GM_getValue("colorBadges",1));GM_deleteValue("colorBadges");GM_setValue("userDetail",GM_getValue("userDetails",1));GM_deleteValue("userDetails");GM_setValue("activeTalk",GM_getValue("activeThread",2));GM_deleteValue("activeThread")})();var d={fixedElms:{value:GM_getValue("fixedElms",6),set:{type:"square",opt:["Header","Sidebar","Footer"]},query:"Set fixed elements:"},loadLists:{value:GM_getValue("loadLists",15),set:{type:"square",opt:["Giveaways","Discussions","Trades","Comments"]},query:"Continuously load:"},gridView:{value:GM_getValue("gridView",0),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaways in a grid view?"},featuredGA:{value:GM_getValue("featuredGA",2),set:{type:"circle",opt:["Yes","Expanded","No"]},query:"Show featured giveaways section?"},hideEntry:{value:GM_getValue("hideEntry",1),set:{type:"circle",opt:["Yes","No"]},query:"Hide entered giveaways?"},oneHide:{value:GM_getValue("oneHide",0),set:{type:"circle",opt:["Yes","No"]},query:"Skip confirmation when hiding games?"},winPercent:{value:GM_getValue("winPercent",1),set:{type:"circle",opt:["Yes","No"]},query:"Show giveaway win percentage?"},searchSame:{value:GM_getValue("searchSame",1),set:{type:"circle",opt:["Yes","No"]},query:"Show buttons to quickly search for similar giveaways?"},newBadges:{value:GM_getValue("newBadges",1),set:{type:"circle",opt:["Yes","No"]},query:"Show additional giveaway badges?"},colorBadge:{value:GM_getValue("colorBadge",1),set:{type:"circle",opt:["Yes","No"]},query:"Recolor standard giveaway badges?"},searchNav:{value:GM_getValue("searchNav",0),set:{type:"circle",opt:["Yes","No"]},query:"Show the giveaway search bar in the top navigation?"},pointInvl:{value:GM_getValue("pointInvl",0),set:{type:"number",opt:["Seconds"],about:"Value in seconds, enter 0 to disable."},query:"Regularly update points value?"},sideMine:{value:GM_getValue("sideMine",0),set:{type:"circle",opt:["Yes","No"]},query:"Hide 'My Giveaways' in the sidebar? (Still available under nav dropdown)"},activeTalk:{value:GM_getValue("activeTalk",2),set:{type:"circle",opt:["Yes","Sidebar","No"]},query:"Show the 'Active Discussions' section?"},collapsed:{value:GM_getValue("collapsed",3),set:{type:"square",opt:["Discussions","Trades"]},query:"After first page, collapse original post:"},userTools:{value:GM_getValue("userTools",1),set:{type:"circle",opt:["Yes","No"]},query:"Show SGTools links on user pages?"},userDetail:{value:GM_getValue("userDetail",1),set:{type:"circle",opt:["Yes","No"]},query:"Show user details on avatar hover?"},userLists:{value:GM_getValue("userLists",1),set:{type:"circle",opt:["Yes","No"]},query:"Label black-/white- listed users?",sub:{name:"Configure",settings:{userWhite:{value:JSON.parse(GM_getValue("userWhite",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Whitelisted label colors:"},userBlack:{value:JSON.parse(GM_getValue("userBlack",'{"Foreground": "", "Background": ""}')),set:{type:"text",opt:["Foreground","Background"],about:"Enter value as hexadecimal color, leave blank for defaults."},query:"Blacklisted label colors:"}}}}};
var b=JSON.parse(GM_getValue("userTags","{}"));var e={debug:0,logging:{debug:function(g){if(e.debug<-1){console.debug("[SGT DEBUG] ",g)}},info:function(g){if(e.debug<0){console.log("[SGT INFO] ",g)}},warn:function(g){if(e.debug<0){console.warn("[SGT WARN] ",g)}},alert:function(g){console.log("[SGT ALERT] ",g)}},helpers:{fromQuery:function(i){var h,g={},k=/([^&=]+)=?([^&]*)/g,j=function(l){return decodeURIComponent(l.replace(/\+/g," "))};while(h=k.exec(location.search.substring(1))){g[j(h[1])]=j(h[2])}return g[i]},isGAlist:function(){return !(~location.href.indexOf("/trade")||~location.href.indexOf("/discussion")||~location.href.indexOf("/giveaway/")||~location.href.indexOf("/account/")||~location.href.indexOf("/archive")||~location.href.indexOf("/settings"))},listingPit:{cache:{wishes:{name:"cache-wish",page:"/account/steam/wishlist/search?page=",touches:".table__column__secondary-link",list:null},white:{name:"cache-white",page:"/account/manage/whitelist/search?page=",touches:".table__column__heading",list:null},black:{name:"cache-black",page:"/account/manage/blacklist/search?page=",touches:".table__column__heading",list:null}},getList:function(h,j){e.logging.debug("Pulling list for "+h);var g=e.helpers.listingPit.cache[h];if(!g.list){var i=JSON.parse(GM_getValue(g.name,null));if(i==null){e.logging.debug("Entering hell..");e.helpers.listingPit.callbackHell(g.page,1,g.touches,function(k){GM_setValue(g.name,JSON.stringify(k));GM_setValue(g.name+"-time",Date.now());g.list=k;j(k)})}else{e.logging.debug("Had it saved..");g.list=i;j(i)}}else{e.logging.debug("Already loaded..");j(g.list)}},invalidateList:function(g){e.logging.debug("Invalidating "+g);GM_setValue(e.helpers.listingPit.cache[g].name,null)},callbackHell:function(h,j,i,g){$.ajax({method:"GET",url:h+j}).done(function(n){var l=$(n),m=l.find(".pagination__navigation").children().last().attr("data-page-number");var k=[];$.each(l.find(i),function(o,p){k.push($(p).attr("href"))});if(j<m){e.logging.debug("Going deeper..");e.helpers.listingPit.callbackHell(h,++j,i,function(o){g($.merge(k,o))})}else{g(k)}})}},makeSideLink:function(h,g,j,i){var m=$("<li/>").addClass("sidebar__navigation__item");var k=$("<a/>").addClass("sidebar__navigation__item__link").attr("href",h).appendTo(m);var l=$("<div/>").addClass("sidebar__navigation__item__name").html(g).appendTo(k);if(i!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(i).appendTo(l)}$("<div/>").addClass("sidebar__navigation__item__underline").appendTo(k);if(j!==undefined){$("<div/>").addClass("sidebar__navigation__item__count").html(j).appendTo(k)}return m},makeTopLink:function(j,i,m,k,h){var l=$("<a/>").addClass("nav__row").attr("href",j);$("<i/>").addClass("icon-"+h).addClass("fa fa-fw fa-"+k).appendTo(l);var g=$("<div/>").addClass("nav__row__summary").appendTo(l);$("<p/>").addClass("nav__row__summary__name").html(i).appendTo(g);$("<p/>").addClass("nav__row__summary__description").html(m).appendTo(g);return l},settings:{makeRow:function(r,j,q,g){var n;
switch(g.set.type){case"circle":n=e.helpers.settings.makeRadio(j,q,g);break;case"square":n=e.helpers.settings.makeCheck(j,q,g);break;case"number":case"text":n=e.helpers.settings.makeText(j,q,g);break;default:e.logging.warn("Cannot determine options type: "+g.set.type);return}r.append(n);if(g.sub){n.find(".form__checkbox").last().after($("<div/>").addClass("form__checkbox is-selected").append($("<a/>").html(g.sub.name)).on("click",function(i){$("#sub_"+q).toggle();i.stopImmediatePropagation()}));var o="abcde";var m=$("<div/>").attr("id","sub_"+q).css("display","none").appendTo(r);var p=Object.keys(g.sub.settings);for(var l=0;l<p.length;l++){var h=p[l];if(g.sub.settings.hasOwnProperty(h)){e.helpers.settings.makeRow(m,j+o.substring(l,l+1),h,g.sub.settings[h])}}}},makeHeading:function(i,h){var g=$("<div/>").addClass("form__row");$("<div/>").addClass("form__heading").append($("<div/>").addClass("form__heading__number").html(i+".")).append($("<div/>").addClass("form__heading__text").html(h)).appendTo(g);return g},makeRadio:function(l,k,j){var n=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",k).val(j.value));for(var h=0;h<j.set.opt.length;h++){var m=j.set.opt.length-1-h;var g=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",m).append("<i class='form__checkbox__default fa fa-circle-o'></i>").append("<i class='form__checkbox__hover fa fa-circle'></i>").append("<i class='form__checkbox__selected fa fa-check-circle'></i>").append(j.set.opt[h]);if(j.value==m){g.addClass("is-selected")}else{g.addClass("is-disabled")}n.append(g)}return e.helpers.settings.makeHeading(l,j.query).append($("<div/>").addClass("form__row__indent").append(n))},makeCheck:function(k,j,h){var n=$("<div/>").append($("<input/>").attr("type","hidden").attr("name",j).val(h.value));for(var g=0;g<h.set.opt.length;g++){var m=Math.pow(2,h.set.opt.length-1-g);var l=$("<div/>").addClass("form__checkbox").attr("data-checkbox-value",m).append("<i class='form__checkbox__default fa fa-square-o'></i>").append("<i class='form__checkbox__hover fa fa-square'></i>").append("<i class='form__checkbox__selected fa fa-check-square'></i>").append(h.set.opt[g]).on("click",function(i){var o=$(this),p=o.siblings("input");p.val(p.val()^o.attr("data-checkbox-value"));if(p.val()&o.attr("data-checkbox-value")){o.removeClass("is-disabled").addClass("is-selected")}else{o.addClass("is-disabled").removeClass("is-selected")}i.stopImmediatePropagation()});if(h.value&m){l.addClass("is-selected")}else{l.addClass("is-disabled")}n.append(l)}return e.helpers.settings.makeHeading(k,h.query).append($("<div/>").addClass("form__row__indent").append(n))},makeText:function(k,j,h){var g=$("<div/>").addClass("form__row__indent");$.each(h.set.opt,function(m,l){var o=h.value,n="";if(h.set.opt.length>1){o=h.value[l];n="_"+m}g.append($("<input/>").attr("type",h.set.type).attr("name",j+n).attr("placeholder",l).addClass("form__input-small").val(o))});var i=$("<div/>").addClass("form__input-description").html(h.set.about);
return e.helpers.settings.makeHeading(k,h.query).append(g.append(i))}},applyGradients:function(h,g){h.css("background-image","linear-gradient("+g+")").css("background-image","-moz-linear-gradient("+g+")").css("background-image","-webkit-linear-gradient("+g+")")}},settings:{invalidateOnSync:function(){if(!d.newBadges.value||!~location.href.indexOf("/profile/sync")){return}$(".form__sync-default").on("click",function(){e.helpers.listingPit.invalidateList("wishes")})},injectMenu:function(i){e.logging.debug("Adding custom navigation");var h=$("<div/>").addClass("nav__button-container");$("<a/>").addClass("nav__button nav__buton--is-dropdown").attr("href","/ąccount/settings/ribbit").html("SGT frog").appendTo(h);$("<div/>").addClass("nav__button nav__button--is-dropdown-arrow").html("<i class='fa fa-angle-down'></i>").appendTo(h).on("click",function(l){var k=$(this).hasClass("is-selected");$("nav .nav__button").removeClass("is-selected"),$("nav .nav__relative-dropdown").addClass("is-hidden"),k||$(this).addClass("is-selected").siblings(".nav__relative-dropdown").removeClass("is-hidden"),l.stopImmediatePropagation()});var j=$("<div/>").addClass("nav__relative-dropdown is-hidden").appendTo(h);$("<div/>").addClass("nav__absolute-dropdown").append(e.helpers.makeTopLink("/ąccount/settings/ribbit","Settings","Adjust tool functionality.","gears","grey")).append(e.helpers.makeTopLink("https://github.com/bberenz/sgtfrog/issues","Feedback","Report an issue or request a feature.","github","green")).append(e.helpers.makeTopLink("https://www.steamgifts.com/discussion/4C3Cl/userscript-steamgifts-tinkerer-featuring-refined-ostensible-gain","Discussion","View the SteamGifts discussion thread.","square-o","blue")).appendTo(j);$(".nav__right-container").find(".nav__button-container:not(.nav__button-container--notification)").last().before(h);var g=e.helpers.makeSideLink("/ąccount/settings/ribbit","SGT frog");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().after(g);if(i){g.addClass("is-selected");g.find(".sidebar__navigation__item__name").before("<i class='fa fa-caret-right'></i>")}},injectPage:function(){if(location.pathname==="/%C4%85ccount/settings/ribbit"){e.logging.info("Creating custom settings page");GM_addStyle("body{ background-image: none; background-color: #95A4C0; }");var g=$("style").detach();$("html").empty();$.ajax({method:"GET",url:"/account/settings/sales"}).done(function(o){var m=o.substring(o.indexOf("<head>")+6,o.indexOf("</head>")).replace(/<script [\s\S]+?<\/script>/g,"");$("<head/>").appendTo("html").append(m).append("<script src='https://cdn.steamgifts.com/js/minified.js'><\/script>");$("<body/>").appendTo("html").append(o.substring(o.indexOf("<body>")+6,o.indexOf("</body>")));g.appendTo("html");$(".page__heading__breadcrumbs").children("a").last().html("Sgt Frog").attr("href","/ąccount/settings/ribbit");$(".sidebar__navigation").find("a[href='/account/settings/sales']").parent().removeClass("is-selected").find("i").remove();
$("title").html("Account - Settings - Ribbit");var j=$(".form__rows");j.empty();var n=Object.keys(d);for(var l=0;l<n.length;l++){var h=n[l];if(d.hasOwnProperty(h)){e.helpers.settings.makeRow(j,l+1,h,d[h])}}$("<div/>").addClass("form__submit-button").html("<i class='fa fa-arrow-circle-right'></i> Save Changes").on("click",function(){e.settings.save(d)}).appendTo(j);e.logging.debug("Creation complete");window.setTimeout(function(){e.settings.injectMenu(true);e.giveaways.injectNavSearch();e.fixedElements.header();e.fixedElements.sidebar();e.fixedElements.footer();f.scroll()},500)})}},save:function(p){var n=function(i,j){e.logging.debug("Setting "+i+" to "+j);GM_setValue(i,j)};var r=Object.keys(p);for(var m=0;m<r.length;m++){var h=r[m];if(p.hasOwnProperty(h)){if(p[h].set.type=="text"&&p[h].set.opt.length>1){var q={};for(var l=0;l<p[h].set.opt.length;l++){var g=$("input[name='"+h+"_"+l+"']");q[p[h].set.opt[l]]=g.val()}n(h,JSON.stringify(q))}else{var o=$("input[name='"+h+"']");n(h,+o.val())}if(p[h].sub){e.settings.save(p[h].sub.settings)}}}e.logging.info("Saved new settings");window.scrollTo(0,0);location.reload()}},fixedElements:{header:function(){if(!(d.fixedElms.value&4)){return}GM_addStyle("header.fixed{ position: fixed; top: 0; width: 100%; z-index: 100; } .left-above{ margin-top: 39px !important; }");$("header").addClass("fixed");var g=$(".featured__container");if(g.length>0){g.addClass("left-above")}else{$(".page__outer-wrap").addClass("left-above")}},sidebar:function(){if(!(d.fixedElms.value&2)){return}var j=d.fixedElms.value&4?64:25;GM_addStyle(".sidebar .fixed{ position: fixed; top: "+j+"px; }");var h=$(".sidebar"),g=$("<div/>").addClass("sidebar__outer-wrap"),i=$(".sidebar__mpu");h.children().detach().appendTo(g);g.appendTo(h);f.on("scroll",function(){var k=$(".featured__container").height()+64;if(f.scrollTop()>(k-j)){h.children().addClass("fixed");i.hide()}else{h.children().removeClass("fixed");i.show()}});g.css("width",h.css("min-width")).css("min-width",h.css("min-width")).css("max-width",h.css("max-width"))},footer:function(){if(!(d.fixedElms.value&1)){return}GM_addStyle(".footer__outer-wrap.fixed{ position: fixed; bottom: 0; width: 100%;   background-color: #95a4c0; z-index: 100; } .left-below{ margin-bottom: 45px; }");$(".footer__outer-wrap").addClass("fixed");$(".page__outer-wrap").addClass("left-below")}},sidebar:{removeMyGA:function(){if(!d.sideMine.value){return}var h=$(".sidebar");var g=h.find(".sidebar__heading").last();if(g.html()==="My Giveaways"){g.remove();h.find(".sidebar__navigation").last().remove()}},injectSGTools:function(){if(!d.userTools.value||!~location.href.indexOf("/user/")){return}var h=location.href.split("/")[4];e.logging.debug("Found user: "+h);var g=$(".sidebar__navigation").last(),i=$("<ul/>").append(e.helpers.makeSideLink("http://www.sgtools.info/sent/"+h,"Real Value Sent").find("a").attr("target","_check"),e.helpers.makeSideLink("http://www.sgtools.info/won/"+h,"Real Value Won").find("a").attr("target","_check"),e.helpers.makeSideLink("http://www.sgtools.info/nonactivated/"+h,"Non-Activated").find("a").attr("target","_check"),e.helpers.makeSideLink("http://www.sgtools.info/multiple/"+h,"Multi Wins").find("a").attr("target","_check"));
$("<h3/>").html("SG Tools").addClass("sidebar__heading").insertAfter(g).after(i.addClass("sidebar__navigation"))}},giveaways:{injectFlags:{all:function(g){if(d.newBadges.value){e.giveaways.injectFlags.wishlist(g);e.giveaways.injectFlags.recent(g)}if(d.colorBadge.value){e.giveaways.injectFlags.invite();e.giveaways.injectFlags.region();e.giveaways.injectFlags.whitelist();e.giveaways.injectFlags.group()}},wishlist:function(j,h){var g=$(".giveaway__row-outer-wrap");if(g.length>0){if(!h){GM_addStyle(".giveaway__column--wish{ background-image: linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -moz-linear-gradient(#FFFACF 0%, #FFF176 100%);   background-image: -webkit-linear-gradient(#FFFACF 0%, #FFF176 100%);   border-color: #EDCCBE #F0C2AF #DEAB95 #F2C4B1 !important; color: #F57F17;   box-shadow: none !important; }")}var i=$("<div/>").addClass("giveaway__column--wish").attr("title","Wishlist");$("<i/>").addClass("fa fa-fw fa-star").appendTo(i);if(Date.now()-GM_getValue("cache-wish-time",0)>(24*60*60*1000)){e.helpers.listingPit.invalidateList("wishes")}e.helpers.listingPit.getList("wishes",function(k){e.logging.info("Applying badges for "+k.length+" wishes");$.each(k,function(m,o){var l=j.find("a[href='"+o+"']").parent().parent();var n=l.find(".giveaway__columns--badges");if(n.length){n.prepend(i.clone())}else{l.find(".giveaway__column--width-fill").after(i.clone())}})})}},recent:function(i,g){if(!g){GM_addStyle(".giveaway__column--new{   background-image: linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -moz-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   background-image: -webkit-linear-gradient(#FFE0B2 0%, #FFB74D 100%);   border-color: #FFCCBC #FFAB91 #FF8A65 #FFAB91 !important; color: #BF360C;   box-shadow: none !important; }")}var h=$("<div/>").addClass("giveaway__column--new").attr("title","New");$("<i/>").addClass("fa fa-fw fa-fire").appendTo(h);$.each(i.find(".giveaway__column--width-fill").find("span"),function(j,m){var l=$(m);var k=l.html();if(~k.indexOf("second")||~k.indexOf("minute")){l.parent().parent().find(".giveaway__column--width-fill").after(h.clone())}})},invite:function(){GM_addStyle(".giveaway__column--invite-only{ background-image: linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -moz-linear-gradient(#FFCDD2 0%, #F49B95 100%);   background-image: -webkit-linear-gradient(#FFCDD2 0%, #F49B95 100%);   border-color: #ef9a9a #e57373 #ef5350 #e57373 !important; color: #950000; }")},region:function(){GM_addStyle(".giveaway__column--region-restricted{ background-image: linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -moz-linear-gradient(#D7CCC8 0%, #A18F89 100%);   background-image: -webkit-linear-gradient(#D7CCC8 0%, #A18F89 100%);   border-color: #BDBDBD #9E9E9E #757575 #9E9E9E !important; color: #5D4037; }")},whitelist:function(){GM_addStyle(".giveaway__column--whitelist{ background-image: linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -moz-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   background-image: -webkit-linear-gradient(#FFFFFF 0%, #E0E0E0 100%);   color: #D81B60 !important; }")
},group:function(){GM_addStyle(".giveaway__column--group{ background-image: linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -moz-linear-gradient(#DCEDC8 0%, #AED581 100%);   background-image: -webkit-linear-gradient(#DCEDC8 0%, #AED581 100%); ")}},injectChance:function(h){if(!d.winPercent.value){return}var g=function(i,j){return"<i class='fa fa-bar-chart'></i> <span>"+Math.min(100,(1/i)*j*100).toFixed(3)+"% chance</span>"};$.each(h.find(".giveaway__row-outer-wrap"),function(k,p){var n=$(p);var j=n.find(".fa-tag").next().html().split(/\s/)[0].replace(/,/g,"");var m=n.find(".giveaway__columns").children().first().find("span").html().substr(0,5);if(m!=="Ended"&&!n.find(".giveaway__row-inner-wrap").hasClass("is-faded")){j++}var o=1;var q=n.find(".giveaway__heading__thin").first().html();if(q&&~q.indexOf("Copies")){o=+(q.replace(/([\(\),\s]|Copies)/g,""))}var l=$("<div/>").html(g(j,o));n.find(".giveaway__columns").children().first().after(l)});$.each(h.find(".featured__columns"),function(m,o){var l=h.find(".live__entry-count");if(!l||l.length===0){return}var j=l.html().replace(/,/g,"");var k=h.find(".sidebar__entry-insert");if(k&&k.length>0&&!k.hasClass("is-hidden")){j++}var p=1;var q=h.find(".featured__heading__small").first().html();if(~q.indexOf("Copies")){p=+(q.replace(/([\(\),\s]|Copies)/g,""))}var n=$("<div/>").addClass("featured__column").html(g(j,p));$(o).children().first().after(n)})},injectSearch:function(j,h){if(!d.searchSame.value){return}$.each(j.find(".giveaway__heading"),function(k,m){var l=$(m);$("<a/>").addClass("giveaway__icon").html("<i class='fa fa-search-plus'></i>").attr("title","Find similar giveaways").attr("href","/giveaways/search?q="+l.find(".giveaway__heading__name").html()).appendTo(l)});if(~location.href.indexOf("/giveaway/")){if(!h){GM_addStyle(".sidebar__shortcut-inner-wrap div{ padding: 0; } .sidebar__shortcut-inner-wrap .sidebar__error{ border-color: #f0d1dc #e5bccc #d9a7ba #ebbecf; }")}var g=$(".sidebar__navigation").parent();var i=g.children().first().not(".sidebar__mpu").detach();if(!i.hasClass("sidebar__error")){i.css("background-image","none").css("border","none")}else{e.helpers.applyGradients(i,"#f7edf1 0%, #e6d9de 100%")}$("<div/>").addClass("sidebar__shortcut-inner-wrap").append($("<a/>").addClass("sidebar__entry-loading").css("max-width",(i.length>0?"33%":"100%")).html("<i class='fa fa-search'></i> Find Similar").attr("href","/giveaways/search?q="+$(".featured__heading__medium").html())).append(i).appendTo($("<div/>").addClass("sidebar__shortcut-outer-wrap").prependTo(g))}},injectNavSearch:function(){if(!d.searchNav.value){return}var g=$("<div/>").addClass("sidebar__search-container").css("margin","0 5px 0 0").css("height","inherit").append($("<input class='sidebar__search-input' placeholder='Search Giveaways...' value='' type='text' />").on("keypress",function(h){if(h.which===13){location.href="/giveaways/search?q="+$(this).val();h.stopImmediatePropagation()}})).append("<i class='fa fa-search'></i>");
$(".nav__left-container").prepend(g)},hideEntered:function(g){if(!d.hideEntry.value||~location.href.indexOf("/giveaways/won")){return}g.find(".is-faded").parent(".giveaway__row-outer-wrap").remove()},easyHide:function(g){if(!d.oneHide.value){return}g.find("[data-popup='popup--hide-games']").on("click",function(h){window.setTimeout(function(){$(".js__submit-hide-games").click()},100)})},gridForm:function(h,g){if(!d.gridView.value||!e.helpers.isGAlist()){return}if(!g){GM_addStyle(".pagination{ clear: both; } .giveaway__row-outer-wrap{ width: 19%; margin-right: 1%; float: left; } .giveaway__row-inner-wrap{ display: block; } .global__image-outer-wrap--game-medium{ width: initial; margin: 0 auto !important; } .giveaway__heading{ display: block; text-align: center; } .giveaway__heading:first-of-type{ height: auto; text-overflow: ellipsis; overflow: hidden; } .giveaway__columns-full{ display: block; } .giveaway__columns-full > :not(:last-child){ margin: 0 0 5px 0; } .giveaway__columns--badges{ margin-bottom: 5px; } .giveaway__columns--badges > .giveaway__column--contributor-level:not(.giveaway__column--empty){ -webkit-box-flex: 1; -moz-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; } .giveaway__column--empty{ height: 26px; width: 0; padding: 0; margin: 0 !important; visibility: hidden; } .giveaway__links{ display: block; margin-top: 5px; } .giveaway__links a{ margin-right: 5px; } .pinned-giveaways__inner-wrap--minimized .giveaway__row-outer-wrap:nth-child(-n+5){ display: initial; } .giveaway__row--empty{ clear: both; } ")}h.find(".giveaway__columns").addClass("giveaway__columns-full");$.each(h.find(".giveaway__row-outer-wrap"),function(l,m){var j=$(m);j.find(".global__image-outer-wrap--avatar-small").remove();j.find(".giveaway__row-inner-wrap").prepend(j.find(".global__image-outer-wrap--game-medium").detach());j.find(".giveaway__summary").prepend($("<h2/>").addClass("giveaway__heading").html(j.find(".giveaway__heading__name").detach()));j.find(".giveaway__columns").before($("<div/>").addClass("giveaway__columns giveaway__columns--badges").html(j.find(".giveaway__column--width-fill").nextAll().detach()).prepend($("<div/>").addClass("giveaway__column--empty")));var k=j.find(".fa-tag").next();k.html(k.text().replace(/([\d,]+) \w+/,"$1"));k=j.find(".fa-comment").next();k.html(k.text().replace(/([\d,]+) \w+/,"$1"))});h.find(".pinned-giveaways__inner-wrap").append($("<div/>").addClass("giveaway__row--empty"))},bulkFeatured:{find:function(){switch(d.featuredGA.value){case 0:e.giveaways.bulkFeatured.hidden();break;case 1:e.giveaways.bulkFeatured.expanded();break;default:e.giveaways.bulkFeatured.injectCollapsable();break}},injectCollapsable:function(){if($(".pinned-giveaways__inner-wrap").children().length<3){return}GM_addStyle(".pinned-giveaways__button{ clear: both; } .pinned-giveaways__inner-wrap:not(.pinned-giveaways__inner-wrap--minimized){   border-radius: 4px 4px 0 0; margin-bottom: 0; }");$(".pinned-giveaways__button").off("click");$(".pinned-giveaways__button").addClass("pinned-giveaways__button-expand");
var g=$("<div/>").hide().addClass("pinned-giveaways__button").addClass("pinned-giveaways__button-collapse").html("<i class='fa fa-angle-up'></i>").appendTo(".pinned-giveaways__outer-wrap");g.on("click",function(h){$(".pinned-giveaways__inner-wrap").addClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").show();$(".pinned-giveaways__button-collapse").hide();h.preventDefault()});$(".pinned-giveaways__button-expand").on("click",function(){$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()})},hidden:function(){$(".pinned-giveaways__outer-wrap").remove()},expanded:function(){e.giveaways.bulkFeatured.injectCollapsable();$(".pinned-giveaways__inner-wrap").removeClass("pinned-giveaways__inner-wrap--minimized");$(".pinned-giveaways__button-expand").hide();$(".pinned-giveaways__button-collapse").show()}},activeThreads:{find:function(){switch(d.activeTalk.value){case 0:e.giveaways.activeThreads.hidden();break;case 1:e.giveaways.activeThreads.sidebar();break;default:break}},hidden:function(){$(".widget-container.widget-container--margin-top").children().remove()},sidebar:function(){var g=$(".sidebar__navigation").last();if($(".widget-container.widget-container--margin-top").length===0){return}var h=$("<ul/>").addClass("sidebar__navigation");$.each($(".table__row-inner-wrap"),function(m,k){var l=$(k);var n=l.find(".table__column--width-fill").first();var j=n.find("h3").find("a");h.append(e.helpers.makeSideLink(j.attr("href"),j.html(),l.find(".table__column--width-small").find("a").html(),"by "+n.find("a").last().html()))});$("<h3/>").addClass("sidebar__heading").html("Active Discussions").insertAfter(g).after(h);e.giveaways.activeThreads.hidden()}}},threads:{collapseDiscussion:function(){if(!(d.collapsed.value&2)||!~location.href.indexOf("/discussion/")){return}var g=e.helpers.fromQuery("page");if(g&&g>1){$(".comment__collapse-button").first().trigger("click")}},collapseTrade:function(){if(!(d.collapsed.value&1)||!~location.href.indexOf("/trade/")){return}var g=e.helpers.fromQuery("page");if(g&&g>1){$(".comment__collapse-button").first().trigger("click")}},injectTimes:function(g){if(!~location.href.indexOf("/discussion/")&&!~location.href.indexOf("/trade/")){return}$.each(g.find(".comment__actions"),function(k,l){var o=$($(l).children().first().children()[1]);if(o.length){var m,n=o.attr("title").replace(/Edited:/,""),j=n.match(/(\w+ \d+, \d{4}|Yesterday|Today), (\d+):(\d{2})(am|pm)/i);if(j[1]==="Today"||j[1]==="Yesterday"){m=new Date();if(j[1]==="Yesterday"){m.setDate(m.getDate()-1)}}else{m=new Date(j[1])}m.setHours(+j[2]+((+j[2]<12&&j[4]=="pm")?12:0)-(+j[2]==12&&j[4]=="am"?12:0),+j[3],0,0);e.logging.debug(n+"-->"+m.toString());var q,h,p=Math.floor((new Date()-m)/1000);var h=Math.floor(p/31622400);if(h>1){q=h+" year"}else{h=Math.floor(p/2678400);if(h>1){q=h+" month"}else{h=Math.floor(p/86400);if(h>=1){q=h+" day"
}else{h=Math.floor(p/3600);if(h>=1){q=h+" hour"}else{h=Math.floor(p/60);if(h>=1){q=h+" minute"}else{q=p+" second"}}}}}o.html(" <strong>*Edited: "+q+(h==1?"":"s")+" ago</strong>")}})}},loading:{everyNew:function(g){e.giveaways.injectFlags.wishlist(g,true);e.giveaways.injectFlags.recent(g,true);e.giveaways.injectChance(g);e.giveaways.injectSearch(g,true);e.giveaways.hideEntered(g);e.giveaways.easyHide(g);e.giveaways.gridForm(g,true);e.users.profileHover(g,true);e.users.tagging.show(g,true);e.users.listIndication(g,true)},giveaways:function(){if(!(d.loadLists.value&8)||!e.helpers.isGAlist()){return}GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var g=e.helpers.fromQuery("page");if(g==undefined){g=1}$(".widget-container").find(".page__heading").first().after($(".pagination").detach());var h=false;f.on("scroll",function(){var i=(f.scrollTop()+$(window).height())/f.height();if(i>=0.9&&!h){h=true;g++;var j=location.href;if(~j.indexOf("?")){j=j.replace(/page=\d+?&?/,"")}else{if(location.pathname.length==1){j+="/giveaways"}j+="/search?"}e.loading.addSpinner($(".giveaway__row-outer-wrap").last());e.logging.info("Loading next page: "+g);e.logging.debug(j+"&page="+g);$.ajax({method:"GET",url:j+"&page="+g}).done(function(n){var k=$(n);e.loading.everyNew(k);k.find(".pinned-giveaways__outer-wrap").remove();var m=k.find(".giveaway__row-outer-wrap").detach();if(m.length===0){e.logging.info("No more giveaways");e.loading.removeSpinner();return}var l=k.find(".pagination");l.find(".pagination__navigation").html("Page "+g);$(".giveaway__row-outer-wrap").last().parent().append(l).append(m);h=false;e.loading.removeSpinner()})}})},trade:function(){if(!(d.loadLists.value&2)||!~location.href.indexOf("/trade/")){return}e.loading.comments()},threads:function(){if(!(d.loadLists.value&4)||!~location.href.indexOf("/discussion/")){return}e.loading.comments()},thanks:function(){if(!(d.loadLists.value&1)||!~location.href.indexOf("/giveaway/")){return}e.loading.comments()},comments:function(){GM_addStyle(".pagination__loader{ text-align: center; margin-top: 1em; } .pagination__loader .fa{ font-size: 2em; } ");var h=e.helpers.fromQuery("page");if(h==undefined){h=1}var g=$(".pagination__navigation").children().last().attr("data-page-number");$(".page__heading").last().after($(".pagination").detach());var i=false;f.on("scroll",function(){var j=(f.scrollTop()+$(window).height())/f.height();if(j>=0.9&&!i){i=true;if(h++<g){var k=location.href;if(~k.indexOf("?")){k=k.replace(/page=\d+?&?/,"")}else{k+="/search?"}e.loading.addSpinner($(".comments").last());e.logging.info("Loading next page: "+h+"/"+g);e.logging.debug(k+"&page="+h);$.ajax({method:"GET",url:k+"&page="+h}).done(function(n){var l=$(n);e.users.profileHover(l,true);e.users.tagging.show(l,true);e.users.listIndication(l,true);e.threads.injectTimes(l);var m=l.find(".pagination");m.find(".pagination__navigation").html("Page "+h);$(".comments").last().append(m).append(l.find(".comments").last().children().detach());
i=false;e.loading.removeSpinner()})}}})},addSpinner:function(g){g.after($("<div/>").addClass("pagination__loader").html("<i class='fa fa-spin fa-circle-o-notch'></i>"))},removeSpinner:function(){$(".pagination__loader").remove()},points:function(){if(d.pointInvl.value<1||isNaN(d.pointInvl.value)){return}if(d.pointInvl.value<15){e.logging.alert("Failed to apply defined points interval, using 15 seconds instead");d.pointInvl.value=15}window.setInterval(function(){e.logging.debug("Pulling new point value");$.ajax({method:"GET",url:"/about/brand-assets"}).done(function(g){$(".nav__points").html($(g).find(".nav__points").html())})},d.pointInvl.value*1000)}},users:{profileHover:function(m,i){if(!d.userDetail.value){return}var n=64,j=5;var h=360,t=160;if(!i){GM_addStyle(".user-panel__outer-wrap{ position: absolute; width: "+h+"px; height: "+t+"px; color: #21262f; } .user-panel__inner-wrap{ position: relative; width:100%; height: 100%; } .user-panel__image{ position: absolute; top: 0; left: 0; width: "+n+"px; height: "+n+"px;   border-radius: 5px; } .user-panel__corner{ position: absolute; top: "+(n+j)+"px; bottom: 0; left: 0; right: "+(h-(n+j))+"px;   padding: 5px; background-color: #465670; border-radius: 3px 0 0 3px; } .user-panel__corner .user-panel__icon-load{ font-size: 5em; color: rgba(255,255,255,0.6); } .user-panel__corner .sidebar__shortcut-inner-wrap{ display: block; } .user-panel__corner .sidebar__shortcut__whitelist{ margin: 0 0 5px 0; }.user-panel__stats{ position: absolute; top: 0; bottom: 0; left: "+(n+j)+"px; right: 0;   padding: 5px; background-color: #465670; border-radius: 3px 3px 3px 0; } .user-panel__stats .featured__heading__medium{ font-size: 16px; } .user-panel__stats .featured__heading{ margin-bottom: 0; } .user-panel__stats .featured__table__column{ margin: 0; } ")}var g=$("<div/>").addClass("global__image-outer-wrap user-panel__outer-wrap").appendTo($("body")).hide();var k=$("<div/>").addClass("user-panel__inner-wrap").appendTo(g);var q=$("<a/>").addClass("user-panel__link").append($("<div/>").addClass("user-panel__image")).appendTo(k),l=$("<i/>").addClass("user-panel__icon-load fa fa-spin fa-circle-o-notch"),r=$("<div/>").addClass("user-panel__corner").appendTo(k),s=$("<div/>").addClass("user-panel__stats").appendTo(k);var p,o=null;m.find(".global__image-outer-wrap--avatar-small").not(".global__image-outer-wrap--missing-image").children().hover(function(u){var v=$(this);if(p){window.clearTimeout(p);p=null}p=window.setTimeout(function(){var y=v.parent();if(y.attr("href")!=o){q.attr("href",y.attr("href"));q.find("div").css("background-image",v.css("background-image"));e.helpers.applyGradients(s.html(""),"#515763 0%, #2f3540 100%");e.helpers.applyGradients(r.html(l),"#424751 0%, #2f3540 100%");$.ajax({method:"GET",url:y.attr("href")}).done(function(F){var D=$(F);o=y.attr("href");var B=D.find(".sidebar__suspension-time"),G=$("<div/>").addClass("featured__table__row__left").html(D.find(".featured__heading"));if(B.length){G.find(".featured__heading__medium").css("color","#000").attr("title","Suspension length: "+B.text())
}var E=D.find(".featured__outer-wrap--user").css("background-color"),z=D.find(".featured__table__row__right").find("a").css("color"),C=D.find(".sidebar__shortcut-inner-wrap");C.find(".js__submit-form-inner").remove();C.find("a").remove();r.html(C);e.helpers.applyGradients(r,z+" -120%, "+E+" 65%");s.append(D.find(".featured__table__column").last().prepend($("<div/>").addClass("featured__table__row").css("padding-top","0").append(G).append(D.find(".featured__table__column").first().find(".featured__table__row__right")[2])));e.helpers.applyGradients(s,z+" -20%, "+E+" 80%");var A=y.attr("href");e.users.listenForLists(A,true);e.users.tagging.injectEditor(A,true)})}else{e.users.listenForLists(o,true)}var w=$(u.target);var x=0;if((w.offset().left+h)>window.innerWidth){x=u.target.offsetWidth-h}g.show().css("left",w.offset().left-1-parseInt(y.css("padding-left"))+x).css("top",w.offset().top-1-parseInt(y.css("padding-top")))},250)},function(){window.clearTimeout(p)});$(".user-panel__outer-wrap").on("mouseleave",function(){g.hide();$(".sidebar__shortcut__whitelist").off("click");$(".sidebar__shortcut__blacklist").off("click")})},tagging:{show:function(h,g){if(~location.pathname.indexOf("/user/")){return}if(!g){GM_addStyle(".user__tagged{ text-decoration: none; border-radius: 4px; padding: 2px 4px; margin-left: .5em; background-color: rgba(0,0,0,.01);   text-shadow: none; box-shadow: 1px 1px 1px rgba(0,0,0,0.5) inset, -1px -1px 1px rgba(255,255,255,0.5) inset; } ")}$.each(Object.keys(b),function(j,k){h.find("a[href='/user/"+k+"']").not(".global__image-outer-wrap").append($("<span/>").addClass("user__tagged").html("<i class='fa fa-tag fa-flip-horizontal'></i> "+b[k]))})},injectEditor:function(h,j){if(!~location.pathname.indexOf("/user/")&&!j){return}if(~h.indexOf("/user/")){h=h.substring(6)}if(h==$(".nav__avatar-outer-wrap").attr("href").substring(6)){return}var g=b[h]||"Add User Tag",i="<i class='fa fa-tag fa-flip-horizontal' style='font-size: 14px;'></i> ";$("<div/>").attr("href","#").html("<a>"+i+g+"</a>").css("color",$(".featured__table__row__right").find("a").css("color")).on("click",function(l){var k=$(this);if(k.children("input").length){return}k.html("<input type='text' placeholder='User Tag' value='"+(b[h]||"")+"' maxlength='16' />").on("keypress",function(n){var o=$(this),m=n.which||n.keyCode;if(m==13){var p=$(this).children("input").val();k.html("<a>"+i+(p||"Add User Tag")+"</a>");$("a[href='/user/"+h+"']").find(".user__tagged").remove();if(p){b[h]=p;if(j){$("a[href='/user/"+h+"']").not(".global__image-outer-wrap").append($("<span/>").addClass("user__tagged").html("<i class='fa fa-tag fa-flip-horizontal'></i> "+b[h]));$(".user-panel__outer-wrap").find(".user__tagged").remove()}}else{delete b[h]}GM_setValue("userTags",JSON.stringify(b));o.off("keypress")}else{if(m==27){k.html("<a>"+i+(b[h]||"Add User Tag")+"</a>");o.off("keypress")}}});k.find("input").select().focus().on("blur",function(){k.html("<a>"+i+g+"</a>");$(this).parent().off("keypress")})}).insertAfter((j?".user-panel__outer-wrap ":"")+".featured__heading__medium")
}},listIndication:function(l,j){if(!d.userLists.value||~location.pathname.indexOf("/user/")){return}if(!j){var k=d.userLists.sub.settings.userWhite.value.Foreground||"#2A2",i=d.userLists.sub.settings.userWhite.value.Background||"#FFF",h=d.userLists.sub.settings.userBlack.value.Foreground||"#C55",g=d.userLists.sub.settings.userBlack.value.Background||"#000";if(!~k.indexOf("#")){k="#"+k}if(!~i.indexOf("#")){i="#"+i}if(!~h.indexOf("#")){h="#"+h}if(!~g.indexOf("#")){g="#"+g}GM_addStyle("a.user__whitened{ background-color: "+i+"; color: "+k+" !important; border-radius: 4px; padding: 3px 5px; text-shadow: none; } a.user__blackened{ background-color: "+g+"; color: "+h+" !important; border-radius: 4px; padding: 3px 5px; text-shadow: none; } ")}e.helpers.listingPit.getList("white",function(m){e.logging.info("Applying white to "+m.length+" users");$.each(m,function(o,n){l.find("a[href='"+n+"']").not(".global__image-outer-wrap").addClass("user__whitened").attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")})});e.helpers.listingPit.getList("black",function(m){e.logging.info("Applying black to "+m.length+" users");$.each(m,function(n,o){l.find("a[href='"+o+"']").not(".global__image-outer-wrap").addClass("user__blackened").attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")})})},listenForLists:function(g,h){if(g.indexOf("/user/")!==0){g="/user/"+g}$(".sidebar__shortcut__whitelist").on("click",function(){e.helpers.listingPit.invalidateList("white");e.helpers.listingPit.getList("black",function(k){if(k.indexOf(g)>-1){e.helpers.listingPit.invalidateList("black")}});if(h){var i="a[href='"+g+"']",j=$(i).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(i));j.attr("title","").removeClass("user__blackened").toggleClass("user__whitened").find("i").not(".fa-tag").remove();if(j.hasClass("user__whitened")){j.attr("title","Whitelisted user").prepend("<i class='fa fa-star-o'></i> ")}}});$(".sidebar__shortcut__blacklist").on("click",function(){e.helpers.listingPit.invalidateList("black");e.helpers.listingPit.getList("white",function(k){if(k.indexOf(g)>-1){e.helpers.listingPit.invalidateList("white")}});if(h){var i="a[href='"+g+"']";var j=$(i).not(".global__image-outer-wrap").not($(".user-panel__outer-wrap").find(i));j.attr("title","").removeClass("user__whitened").toggleClass("user__blackened").find("i").not(".fa-tag").remove();if(j.hasClass("user__blackened")){j.attr("title","Blacklisted user").prepend("<i class='fa fa-ban'></i> ")}}})}},pointless:{kccode:function(){GM_addStyle("*{ direction: rtl; } ");$(".fa").addClass("fa-spin")}}};e.settings.injectPage();e.settings.injectMenu();e.settings.invalidateOnSync();e.fixedElements.header();e.fixedElements.sidebar();e.fixedElements.footer();e.loading.trade();e.loading.threads();e.loading.thanks();e.loading.giveaways();e.loading.points();e.giveaways.injectFlags.all(f);e.giveaways.injectChance(f);e.giveaways.injectSearch(f);e.giveaways.injectNavSearch();e.giveaways.hideEntered(f);
e.giveaways.easyHide(f);e.giveaways.gridForm(f);e.sidebar.removeMyGA();e.giveaways.activeThreads.find();e.threads.injectTimes(f);e.sidebar.injectSGTools();e.users.profileHover(f);e.users.tagging.show(f);e.users.tagging.injectEditor($(".featured__heading__medium").text());e.users.listIndication(f);e.users.listenForLists($(".featured__heading__medium").text());window.setTimeout(function(){f.scroll();e.giveaways.bulkFeatured.find();e.threads.collapseDiscussion();e.threads.collapseTrade()},100);var c=[38,38,40,40,37,39,37,39,98,97],a=0;f.on("keypress",function(g){if(g.keyCode==c[a]||g.which==c[a]){if(++a==c.length){console.log("[RIBBIT] - Command received - Iniitiating sequence..");e.pointless.kccode()}}else{a=0}});console.log("[RIBBIT] - SGT Mode Activated!")})();